/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, EventEmitter, Input, Output, ViewChild } from '@angular/core';
import { WebcamImage } from '../domain/webcam-image';
import { Observable } from 'rxjs';
import { WebcamUtil } from '../util/webcam.util';
var WebcamComponent = /** @class */ (function () {
    function WebcamComponent() {
        /**
         * Defines the max width of the webcam area in px
         */
        this.width = 640;
        /**
         * Defines the max height of the webcam area in px
         */
        this.height = 480;
        /**
         * Defines base constraints to apply when requesting video track from UserMedia
         */
        this.videoOptions = WebcamComponent.DEFAULT_VIDEO_OPTIONS;
        /**
         * Flag to enable/disable camera switch. If enabled, a switch icon will be displayed if multiple cameras were found
         */
        this.allowCameraSwitch = true;
        /**
         * Flag to control whether an ImageData object is stored into the WebcamImage object.
         */
        this.captureImageData = false;
        /**
         * The image type to use when capturing snapshots
         */
        this.imageType = WebcamComponent.DEFAULT_IMAGE_TYPE;
        /**
         * The image quality to use when capturing snapshots (number between 0 and 1)
         */
        this.imageQuality = WebcamComponent.DEFAULT_IMAGE_QUALITY;
        /**
         * EventEmitter which fires when an image has been captured
         */
        this.imageCapture = new EventEmitter();
        /**
         * Emits a mediaError if webcam cannot be initialized (e.g. missing user permissions)
         */
        this.initError = new EventEmitter();
        /**
         * Emits when the webcam video was clicked
         */
        this.imageClick = new EventEmitter();
        /**
         * Emits the active deviceId after the active video device was switched
         */
        this.cameraSwitched = new EventEmitter();
        /**
         * available video devices
         */
        this.availableVideoInputs = [];
        /**
         * Indicates whether the video device is ready to be switched
         */
        this.videoInitialized = false;
        /**
         * Index of active video in availableVideoInputs
         */
        this.activeVideoInputIndex = -1;
        /**
         * MediaStream object in use for streaming UserMedia data
         */
        this.mediaStream = null;
        /**
         * width and height of the active video stream
         */
        this.activeVideoSettings = null;
    }
    Object.defineProperty(WebcamComponent.prototype, "trigger", {
        /**
         * If the given Observable emits, an image will be captured and emitted through 'imageCapture' EventEmitter
         */
        set: /**
         * If the given Observable emits, an image will be captured and emitted through 'imageCapture' EventEmitter
         * @param {?} trigger
         * @return {?}
         */
        function (trigger) {
            var _this = this;
            if (this.triggerSubscription) {
                this.triggerSubscription.unsubscribe();
            }
            // Subscribe to events from this Observable to take snapshots
            this.triggerSubscription = trigger.subscribe(function () {
                _this.takeSnapshot();
            });
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(WebcamComponent.prototype, "switchCamera", {
        /**
         * If the given Observable emits, the active webcam will be switched to the one indicated by the emitted value.
         * @param switchCamera Indicates which webcam to switch to
         *   true: cycle forwards through available webcams
         *   false: cycle backwards through available webcams
         *   string: activate the webcam with the given id
         */
        set: /**
         * If the given Observable emits, the active webcam will be switched to the one indicated by the emitted value.
         * @param {?} switchCamera Indicates which webcam to switch to
         *   true: cycle forwards through available webcams
         *   false: cycle backwards through available webcams
         *   string: activate the webcam with the given id
         * @return {?}
         */
        function (switchCamera) {
            var _this = this;
            if (this.switchCameraSubscription) {
                this.switchCameraSubscription.unsubscribe();
            }
            // Subscribe to events from this Observable to switch video device
            this.switchCameraSubscription = switchCamera.subscribe(function (value) {
                if (typeof value === 'string') {
                    // deviceId was specified
                    _this.switchToVideoInput(value);
                }
                else {
                    // direction was specified
                    _this.rotateVideoInput(value !== false);
                }
            });
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Get MediaTrackConstraints to request streaming the given device
     * @param deviceId
     * @param baseMediaTrackConstraints base constraints to merge deviceId-constraint into
     * @returns
     */
    /**
     * Get MediaTrackConstraints to request streaming the given device
     * @private
     * @param {?} deviceId
     * @param {?} baseMediaTrackConstraints base constraints to merge deviceId-constraint into
     * @return {?}
     */
    WebcamComponent.getMediaConstraintsForDevice = /**
     * Get MediaTrackConstraints to request streaming the given device
     * @private
     * @param {?} deviceId
     * @param {?} baseMediaTrackConstraints base constraints to merge deviceId-constraint into
     * @return {?}
     */
    function (deviceId, baseMediaTrackConstraints) {
        /** @type {?} */
        var result = baseMediaTrackConstraints ? baseMediaTrackConstraints : this.DEFAULT_VIDEO_OPTIONS;
        if (deviceId) {
            result.deviceId = { exact: deviceId };
        }
        return result;
    };
    /**
     * Tries to harvest the deviceId from the given mediaStreamTrack object.
     * Browsers populate this object differently; this method tries some different approaches
     * to read the id.
     * @param mediaStreamTrack
     * @returns deviceId if found in the mediaStreamTrack
     */
    /**
     * Tries to harvest the deviceId from the given mediaStreamTrack object.
     * Browsers populate this object differently; this method tries some different approaches
     * to read the id.
     * @private
     * @param {?} mediaStreamTrack
     * @return {?} deviceId if found in the mediaStreamTrack
     */
    WebcamComponent.getDeviceIdFromMediaStreamTrack = /**
     * Tries to harvest the deviceId from the given mediaStreamTrack object.
     * Browsers populate this object differently; this method tries some different approaches
     * to read the id.
     * @private
     * @param {?} mediaStreamTrack
     * @return {?} deviceId if found in the mediaStreamTrack
     */
    function (mediaStreamTrack) {
        if (mediaStreamTrack.getSettings && mediaStreamTrack.getSettings() && mediaStreamTrack.getSettings().deviceId) {
            return mediaStreamTrack.getSettings().deviceId;
        }
        else if (mediaStreamTrack.getConstraints && mediaStreamTrack.getConstraints() && mediaStreamTrack.getConstraints().deviceId) {
            /** @type {?} */
            var deviceIdObj = mediaStreamTrack.getConstraints().deviceId;
            return WebcamComponent.getValueFromConstrainDOMString(deviceIdObj);
        }
    };
    /**
     * Tries to harvest the facingMode from the given mediaStreamTrack object.
     * Browsers populate this object differently; this method tries some different approaches
     * to read the value.
     * @param mediaStreamTrack
     * @returns facingMode if found in the mediaStreamTrack
     */
    /**
     * Tries to harvest the facingMode from the given mediaStreamTrack object.
     * Browsers populate this object differently; this method tries some different approaches
     * to read the value.
     * @private
     * @param {?} mediaStreamTrack
     * @return {?} facingMode if found in the mediaStreamTrack
     */
    WebcamComponent.getFacingModeFromMediaStreamTrack = /**
     * Tries to harvest the facingMode from the given mediaStreamTrack object.
     * Browsers populate this object differently; this method tries some different approaches
     * to read the value.
     * @private
     * @param {?} mediaStreamTrack
     * @return {?} facingMode if found in the mediaStreamTrack
     */
    function (mediaStreamTrack) {
        if (mediaStreamTrack) {
            if (mediaStreamTrack.getSettings && mediaStreamTrack.getSettings() && mediaStreamTrack.getSettings().facingMode) {
                return mediaStreamTrack.getSettings().facingMode;
            }
            else if (mediaStreamTrack.getConstraints && mediaStreamTrack.getConstraints() && mediaStreamTrack.getConstraints().facingMode) {
                /** @type {?} */
                var facingModeConstraint = mediaStreamTrack.getConstraints().facingMode;
                return WebcamComponent.getValueFromConstrainDOMString(facingModeConstraint);
            }
        }
    };
    /**
     * Determines whether the given mediaStreamTrack claims itself as user facing
     * @param mediaStreamTrack
     */
    /**
     * Determines whether the given mediaStreamTrack claims itself as user facing
     * @private
     * @param {?} mediaStreamTrack
     * @return {?}
     */
    WebcamComponent.isUserFacing = /**
     * Determines whether the given mediaStreamTrack claims itself as user facing
     * @private
     * @param {?} mediaStreamTrack
     * @return {?}
     */
    function (mediaStreamTrack) {
        /** @type {?} */
        var facingMode = WebcamComponent.getFacingModeFromMediaStreamTrack(mediaStreamTrack);
        return facingMode ? 'user' === facingMode.toLowerCase() : false;
    };
    /**
     * Extracts the value from the given ConstrainDOMString
     * @param constrainDOMString
     */
    /**
     * Extracts the value from the given ConstrainDOMString
     * @private
     * @param {?} constrainDOMString
     * @return {?}
     */
    WebcamComponent.getValueFromConstrainDOMString = /**
     * Extracts the value from the given ConstrainDOMString
     * @private
     * @param {?} constrainDOMString
     * @return {?}
     */
    function (constrainDOMString) {
        if (constrainDOMString) {
            if (constrainDOMString instanceof String) {
                return String(constrainDOMString);
            }
            else if (Array.isArray(constrainDOMString) && Array(constrainDOMString).length > 0) {
                return String(constrainDOMString[0]);
            }
            else if (typeof constrainDOMString === 'object') {
                if (constrainDOMString['exact']) {
                    return String(constrainDOMString['exact']);
                }
                else if (constrainDOMString['ideal']) {
                    return String(constrainDOMString['ideal']);
                }
            }
        }
        return null;
    };
    /**
     * @return {?}
     */
    WebcamComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.detectAvailableDevices()
            .then(function (devices) {
            // start first device
            _this.switchToVideoInput(devices.length > 0 ? devices[0].deviceId : null);
        })
            .catch(function (err) {
            _this.initError.next((/** @type {?} */ ({ message: err })));
            // fallback: still try to load webcam, even if device enumeration failed
            _this.switchToVideoInput(null);
        });
    };
    /**
     * @return {?}
     */
    WebcamComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.stopMediaTracks();
        this.unsubscribeFromSubscriptions();
    };
    /**
     * Takes a snapshot of the current webcam's view and emits the image as an event
     */
    /**
     * Takes a snapshot of the current webcam's view and emits the image as an event
     * @return {?}
     */
    WebcamComponent.prototype.takeSnapshot = /**
     * Takes a snapshot of the current webcam's view and emits the image as an event
     * @return {?}
     */
    function () {
        // set canvas size to actual video size
        /** @type {?} */
        var _video = this.video.nativeElement;
        /** @type {?} */
        var dimensions = { width: this.width, height: this.height };
        if (_video.videoWidth) {
            dimensions.width = _video.videoWidth;
            dimensions.height = _video.videoHeight;
        }
        /** @type {?} */
        var _canvas = this.canvas.nativeElement;
        _canvas.width = dimensions.width;
        _canvas.height = dimensions.height;
        // paint snapshot image to canvas
        /** @type {?} */
        var context2d = _canvas.getContext('2d');
        context2d.drawImage(this.video.nativeElement, 0, 0);
        // read canvas content as image
        /** @type {?} */
        var mimeType = this.imageType ? this.imageType : WebcamComponent.DEFAULT_IMAGE_TYPE;
        /** @type {?} */
        var quality = this.imageQuality ? this.imageQuality : WebcamComponent.DEFAULT_IMAGE_QUALITY;
        /** @type {?} */
        var dataUrl = _canvas.toDataURL(mimeType, quality);
        // get the ImageData object from the canvas' context.
        /** @type {?} */
        var imageData = null;
        if (this.captureImageData) {
            imageData = context2d.getImageData(0, 0, _canvas.width, _canvas.height);
        }
        this.imageCapture.next(new WebcamImage(dataUrl, mimeType, imageData));
    };
    /**
     * Switches to the next/previous video device
     * @param forward
     */
    /**
     * Switches to the next/previous video device
     * @param {?} forward
     * @return {?}
     */
    WebcamComponent.prototype.rotateVideoInput = /**
     * Switches to the next/previous video device
     * @param {?} forward
     * @return {?}
     */
    function (forward) {
        if (this.availableVideoInputs && this.availableVideoInputs.length > 1) {
            /** @type {?} */
            var increment = forward ? 1 : (this.availableVideoInputs.length - 1);
            /** @type {?} */
            var nextInputIndex = (this.activeVideoInputIndex + increment) % this.availableVideoInputs.length;
            this.switchToVideoInput(this.availableVideoInputs[nextInputIndex].deviceId);
        }
    };
    /**
     * Switches the camera-view to the specified video device
     */
    /**
     * Switches the camera-view to the specified video device
     * @param {?} deviceId
     * @return {?}
     */
    WebcamComponent.prototype.switchToVideoInput = /**
     * Switches the camera-view to the specified video device
     * @param {?} deviceId
     * @return {?}
     */
    function (deviceId) {
        this.videoInitialized = false;
        this.stopMediaTracks();
        this.initWebcam(deviceId, this.videoOptions);
    };
    /**
     * Event-handler for video resize event.
     * Triggers Angular change detection so that new video dimensions get applied
     */
    /**
     * Event-handler for video resize event.
     * Triggers Angular change detection so that new video dimensions get applied
     * @return {?}
     */
    WebcamComponent.prototype.videoResize = /**
     * Event-handler for video resize event.
     * Triggers Angular change detection so that new video dimensions get applied
     * @return {?}
     */
    function () {
        // here to trigger Angular change detection
    };
    Object.defineProperty(WebcamComponent.prototype, "videoWidth", {
        get: /**
         * @return {?}
         */
        function () {
            /** @type {?} */
            var videoRatio = this.getVideoAspectRatio();
            return Math.min(this.width, this.height * videoRatio);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(WebcamComponent.prototype, "videoHeight", {
        get: /**
         * @return {?}
         */
        function () {
            /** @type {?} */
            var videoRatio = this.getVideoAspectRatio();
            return Math.min(this.height, this.width / videoRatio);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(WebcamComponent.prototype, "videoStyleClasses", {
        get: /**
         * @return {?}
         */
        function () {
            /** @type {?} */
            var classes = '';
            if (this.isMirrorImage()) {
                classes += 'mirrored ';
            }
            return classes.trim();
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Returns the video aspect ratio of the active video stream
     */
    /**
     * Returns the video aspect ratio of the active video stream
     * @private
     * @return {?}
     */
    WebcamComponent.prototype.getVideoAspectRatio = /**
     * Returns the video aspect ratio of the active video stream
     * @private
     * @return {?}
     */
    function () {
        // calculate ratio from video element dimensions if present
        /** @type {?} */
        var videoElement = this.video.nativeElement;
        if (videoElement.videoWidth && videoElement.videoWidth > 0 &&
            videoElement.videoHeight && videoElement.videoHeight > 0) {
            return videoElement.videoWidth / videoElement.videoHeight;
        }
        // nothing present - calculate ratio based on width/height params
        return this.width / this.height;
    };
    /**
     * Init webcam live view
     */
    /**
     * Init webcam live view
     * @private
     * @param {?} deviceId
     * @param {?} userVideoTrackConstraints
     * @return {?}
     */
    WebcamComponent.prototype.initWebcam = /**
     * Init webcam live view
     * @private
     * @param {?} deviceId
     * @param {?} userVideoTrackConstraints
     * @return {?}
     */
    function (deviceId, userVideoTrackConstraints) {
        var _this = this;
        /** @type {?} */
        var _video = this.video.nativeElement;
        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            // merge deviceId -> userVideoTrackConstraints
            /** @type {?} */
            var videoTrackConstraints = WebcamComponent.getMediaConstraintsForDevice(deviceId, userVideoTrackConstraints);
            navigator.mediaDevices.getUserMedia((/** @type {?} */ ({ video: videoTrackConstraints })))
                .then(function (stream) {
                _this.mediaStream = stream;
                _video.srcObject = stream;
                _video.play();
                _this.activeVideoSettings = stream.getVideoTracks()[0].getSettings();
                /** @type {?} */
                var activeDeviceId = WebcamComponent.getDeviceIdFromMediaStreamTrack(stream.getVideoTracks()[0]);
                _this.activeVideoInputIndex = activeDeviceId ? _this.availableVideoInputs
                    .findIndex(function (mediaDeviceInfo) { return mediaDeviceInfo.deviceId === activeDeviceId; }) : -1;
                _this.videoInitialized = true;
                _this.cameraSwitched.next(activeDeviceId);
            })
                .catch(function (err) {
                _this.initError.next((/** @type {?} */ ({ message: err.message, mediaStreamError: err })));
            });
        }
        else {
            this.initError.next((/** @type {?} */ ({ message: 'Cannot read UserMedia from MediaDevices.' })));
        }
    };
    /**
     * @private
     * @return {?}
     */
    WebcamComponent.prototype.getActiveVideoTrack = /**
     * @private
     * @return {?}
     */
    function () {
        return this.mediaStream ? this.mediaStream.getVideoTracks()[0] : null;
    };
    /**
     * @private
     * @return {?}
     */
    WebcamComponent.prototype.isMirrorImage = /**
     * @private
     * @return {?}
     */
    function () {
        if (!this.getActiveVideoTrack()) {
            return false;
        }
        // check for explicit mirror override parameter
        {
            /** @type {?} */
            var mirror = 'auto';
            if (this.mirrorImage) {
                if (typeof this.mirrorImage === 'string') {
                    mirror = String(this.mirrorImage).toLowerCase();
                }
                else {
                    // WebcamMirrorProperties
                    if (this.mirrorImage.x) {
                        mirror = this.mirrorImage.x.toLowerCase();
                    }
                }
            }
            switch (mirror) {
                case 'always':
                    return true;
                case 'never':
                    return false;
            }
        }
        // default: enable mirroring if webcam is user facing
        return WebcamComponent.isUserFacing(this.getActiveVideoTrack());
    };
    /**
     * Stops all active media tracks.
     * This prevents the webcam from being indicated as active,
     * even if it is no longer used by this component.
     */
    /**
     * Stops all active media tracks.
     * This prevents the webcam from being indicated as active,
     * even if it is no longer used by this component.
     * @private
     * @return {?}
     */
    WebcamComponent.prototype.stopMediaTracks = /**
     * Stops all active media tracks.
     * This prevents the webcam from being indicated as active,
     * even if it is no longer used by this component.
     * @private
     * @return {?}
     */
    function () {
        if (this.mediaStream && this.mediaStream.getTracks) {
            // getTracks() returns all media tracks (video+audio)
            this.mediaStream.getTracks()
                .forEach(function (track) { return track.stop(); });
        }
    };
    /**
     * Unsubscribe from all open subscriptions
     */
    /**
     * Unsubscribe from all open subscriptions
     * @private
     * @return {?}
     */
    WebcamComponent.prototype.unsubscribeFromSubscriptions = /**
     * Unsubscribe from all open subscriptions
     * @private
     * @return {?}
     */
    function () {
        if (this.triggerSubscription) {
            this.triggerSubscription.unsubscribe();
        }
        if (this.switchCameraSubscription) {
            this.switchCameraSubscription.unsubscribe();
        }
    };
    /**
     * Reads available input devices
     */
    /**
     * Reads available input devices
     * @private
     * @return {?}
     */
    WebcamComponent.prototype.detectAvailableDevices = /**
     * Reads available input devices
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        return new Promise(function (resolve, reject) {
            WebcamUtil.getAvailableVideoInputs()
                .then(function (devices) {
                _this.availableVideoInputs = devices;
                resolve(devices);
            })
                .catch(function (err) {
                _this.availableVideoInputs = [];
                reject(err);
            });
        });
    };
    WebcamComponent.DEFAULT_VIDEO_OPTIONS = { facingMode: 'environment' };
    WebcamComponent.DEFAULT_IMAGE_TYPE = 'image/jpeg';
    WebcamComponent.DEFAULT_IMAGE_QUALITY = 0.92;
    WebcamComponent.decorators = [
        { type: Component, args: [{
                    selector: 'webcam',
                    template: "<div class=\"webcam-wrapper\" (click)=\"imageClick.next();\">\r\n  <video #video [width]=\"videoWidth\" [height]=\"videoHeight\" [class]=\"videoStyleClasses\" autoplay muted playsinline (resize)=\"videoResize()\"></video>\r\n  <div class=\"camera-switch\" *ngIf=\"allowCameraSwitch && availableVideoInputs.length > 1 && videoInitialized\" (click)=\"rotateVideoInput(true)\"></div>\r\n  <canvas #canvas [width]=\"width\" [height]=\"height\"></canvas>\r\n</div>\r\n",
                    styles: [".webcam-wrapper{display:inline-block;position:relative;line-height:0}.webcam-wrapper video.mirrored{-webkit-transform:scale(-1,1);transform:scale(-1,1)}.webcam-wrapper canvas{display:none}.webcam-wrapper .camera-switch{background-color:rgba(0,0,0,.1);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAE9UlEQVR42u2aT2hdRRTGf+cRQqghSqihdBFDkRISK2KDfzDWxHaRQHEhaINKqa1gKQhd6EZLN+IidCH+Q0oWIkVRC21BQxXRitVaSbKoJSGtYGoK2tQ/tU1jY5v0c5F54Xl7b/KSO/PyEt+3e5f75p7zzZwzZ74zUEIJJfyfYaEGllQGVAGZlENdBy6Z2cSiYFTSKkkfS/pH/nBF0kFJdUW9AiRVASeAukD8DgNrzOySrwEzng18KaDzALXuG8W3AiStAvqBisBRNg40mtlPxbYCOgvgPO4bncWW+JpVeDQXRQhIygDfA00F5r0XuNfMrgclQFI98DDQCNQA5ZFXqoCWBVp8XwHRHeEqcN7loy/NbHBesyqpQ1KfFj/6nC+ZvFaApFrgPaCZpYVvgCfNbDiRAElNwGFg+RIt/X8H2s2s9wYCJDUAR4HqJX7++RN40MwGpgmQVAH0AQ2BPz4AHHPl8nBOAqtyFWQjsA6oL4Ada81sPDv7uwImod8kvSJp9RyS8O2SXnb/DYVd2Y9VSroQ4ANXJO2WVJmixqh0kzMWwL4LkiqRtDnA4D1zmfE8j9g9AezcnAHaPcfXdbfdnPZ2Yps6+DwAvO/Z1naTdApY7Xng48BDZnY1MpMVQBuw3iXc5Tnb0wBwBPjUzP6eoezuArZ6svM0geJLkvZEYnl3nkntoqROSbckSW2Suj3ZOIangc7GPJuUtNGdFIfmMeavktoSSKiW9LMPw30Q8JqkekmjCbOZRhuclLQjgYSNxUBAj6RyZ9ATgUJpUtJTCSR8vpAEXHAyWK5BXYFIGHOlepSAloUk4NEYgyoknQhEwhFJ0e8h6VSaQeerCb5uZgdi9utxYBNwOUD93hIVXswM4INCi6K9wAszFC2DwLOBDjHbYp59karIUnRdzYy/3ClqVklaUhfwTICj7K25OqA7a4wWagVsm4Me/xzwg2cCqqONFzO7DPxSCAJi436GUBgHHguQD2oTlJ55oSzP9ybccsttSJw1szdjFOSnI/8dTCGZHwcORp4Nx7y3B1iZ8/sm4MW8/Euxg5wIsS/HaAp3zeP4/G7obRDXI4jiTIA22H7Xdc7X+S3A5lC7QBQ357aq3VAjCeSkwUfAJrfvz+R8A9ADLAtZB+TinpjC5JMA+//jwPZZnF8G7J+L8z4IWB/zbG+gIujVWfLBW/NStVMmqaG4POJRsIjix7h8IGnLQuoBbQki5sVAJHyYm7YkNaRRtXwQ8G1cHpX0iKRrgUjYno17Sf0LrQhJUkdCeHWkVITGJI0k1QeS3ikGSUzOyJUJJNznYneuOCnpTldcxa2kP3xJYqOeSDjqZG8ShJLnE8TTuMS6Iyu1BW7djZqkfo9N0QOuYJmYQddfB7RG+gLTNzqAY9FrL+5/nwEbvDdJJe3zzOrhNP3AWRqmk55t3ZcBuj3b2gb0Sbrbo/NNzk7fFzu7s/E5EiC+rrmeQU0Kx2skvRFoOx2ZzlmSdgbsw49JetvtBpk8nM64d/cGbNtJ0s7cGyJlwHeEv+t3nqnLSgPAUOSGyG3AHUxdzqoJbEcvcL+ZTeTeEapzJKxgaeOcc/7Mf06D7kFrguS0VDAMtGadv+E47DT9tcChJej8ISfpD+abgTe45uOkFi8mnQ+JBVQ+d4VXuOptjavcyot8pq86mfwk8LWZnaOEEkoooYQSSojDv8AhQNeGfe0jAAAAAElFTkSuQmCC);background-repeat:no-repeat;border-radius:5px;position:absolute;right:13px;top:10px;height:48px;width:48px;background-size:80%;cursor:pointer;background-position:center;transition:background-color .2s}.webcam-wrapper .camera-switch:hover{background-color:rgba(0,0,0,.18)}"]
                }] }
    ];
    WebcamComponent.propDecorators = {
        width: [{ type: Input }],
        height: [{ type: Input }],
        videoOptions: [{ type: Input }],
        allowCameraSwitch: [{ type: Input }],
        mirrorImage: [{ type: Input }],
        captureImageData: [{ type: Input }],
        imageType: [{ type: Input }],
        imageQuality: [{ type: Input }],
        imageCapture: [{ type: Output }],
        initError: [{ type: Output }],
        imageClick: [{ type: Output }],
        cameraSwitched: [{ type: Output }],
        video: [{ type: ViewChild, args: ['video',] }],
        canvas: [{ type: ViewChild, args: ['canvas',] }],
        trigger: [{ type: Input }],
        switchCamera: [{ type: Input }]
    };
    return WebcamComponent;
}());
export { WebcamComponent };
if (false) {
    /**
     * @type {?}
     * @private
     */
    WebcamComponent.DEFAULT_VIDEO_OPTIONS;
    /**
     * @type {?}
     * @private
     */
    WebcamComponent.DEFAULT_IMAGE_TYPE;
    /**
     * @type {?}
     * @private
     */
    WebcamComponent.DEFAULT_IMAGE_QUALITY;
    /**
     * Defines the max width of the webcam area in px
     * @type {?}
     */
    WebcamComponent.prototype.width;
    /**
     * Defines the max height of the webcam area in px
     * @type {?}
     */
    WebcamComponent.prototype.height;
    /**
     * Defines base constraints to apply when requesting video track from UserMedia
     * @type {?}
     */
    WebcamComponent.prototype.videoOptions;
    /**
     * Flag to enable/disable camera switch. If enabled, a switch icon will be displayed if multiple cameras were found
     * @type {?}
     */
    WebcamComponent.prototype.allowCameraSwitch;
    /**
     * Parameter to control image mirroring (i.e. for user-facing camera). ["auto", "always", "never"]
     * @type {?}
     */
    WebcamComponent.prototype.mirrorImage;
    /**
     * Flag to control whether an ImageData object is stored into the WebcamImage object.
     * @type {?}
     */
    WebcamComponent.prototype.captureImageData;
    /**
     * The image type to use when capturing snapshots
     * @type {?}
     */
    WebcamComponent.prototype.imageType;
    /**
     * The image quality to use when capturing snapshots (number between 0 and 1)
     * @type {?}
     */
    WebcamComponent.prototype.imageQuality;
    /**
     * EventEmitter which fires when an image has been captured
     * @type {?}
     */
    WebcamComponent.prototype.imageCapture;
    /**
     * Emits a mediaError if webcam cannot be initialized (e.g. missing user permissions)
     * @type {?}
     */
    WebcamComponent.prototype.initError;
    /**
     * Emits when the webcam video was clicked
     * @type {?}
     */
    WebcamComponent.prototype.imageClick;
    /**
     * Emits the active deviceId after the active video device was switched
     * @type {?}
     */
    WebcamComponent.prototype.cameraSwitched;
    /**
     * available video devices
     * @type {?}
     */
    WebcamComponent.prototype.availableVideoInputs;
    /**
     * Indicates whether the video device is ready to be switched
     * @type {?}
     */
    WebcamComponent.prototype.videoInitialized;
    /**
     * If the Observable represented by this subscription emits, an image will be captured and emitted through
     * the 'imageCapture' EventEmitter
     * @type {?}
     * @private
     */
    WebcamComponent.prototype.triggerSubscription;
    /**
     * Index of active video in availableVideoInputs
     * @type {?}
     * @private
     */
    WebcamComponent.prototype.activeVideoInputIndex;
    /**
     * Subscription to switchCamera events
     * @type {?}
     * @private
     */
    WebcamComponent.prototype.switchCameraSubscription;
    /**
     * MediaStream object in use for streaming UserMedia data
     * @type {?}
     * @private
     */
    WebcamComponent.prototype.mediaStream;
    /**
     * @type {?}
     * @private
     */
    WebcamComponent.prototype.video;
    /**
     * Canvas for Video Snapshots
     * @type {?}
     * @private
     */
    WebcamComponent.prototype.canvas;
    /**
     * width and height of the active video stream
     * @type {?}
     * @private
     */
    WebcamComponent.prototype.activeVideoSettings;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2ViY2FtLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25neC13ZWJjYW0vIiwic291cmNlcyI6WyJzcmMvYXBwL21vZHVsZXMvd2ViY2FtL3dlYmNhbS93ZWJjYW0uY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQWdCLFNBQVMsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFhLE1BQU0sRUFBRSxTQUFTLEVBQUMsTUFBTSxlQUFlLENBQUM7QUFFMUcsT0FBTyxFQUFDLFdBQVcsRUFBQyxNQUFNLHdCQUF3QixDQUFDO0FBQ25ELE9BQU8sRUFBQyxVQUFVLEVBQWUsTUFBTSxNQUFNLENBQUM7QUFDOUMsT0FBTyxFQUFDLFVBQVUsRUFBQyxNQUFNLHFCQUFxQixDQUFDO0FBRy9DO0lBQUE7Ozs7UUFXa0IsVUFBSyxHQUFXLEdBQUcsQ0FBQzs7OztRQUVwQixXQUFNLEdBQVcsR0FBRyxDQUFDOzs7O1FBRXJCLGlCQUFZLEdBQTBCLGVBQWUsQ0FBQyxxQkFBcUIsQ0FBQzs7OztRQUU1RSxzQkFBaUIsR0FBWSxJQUFJLENBQUM7Ozs7UUFJbEMscUJBQWdCLEdBQVksS0FBSyxDQUFDOzs7O1FBRWxDLGNBQVMsR0FBVyxlQUFlLENBQUMsa0JBQWtCLENBQUM7Ozs7UUFFdkQsaUJBQVksR0FBVyxlQUFlLENBQUMscUJBQXFCLENBQUM7Ozs7UUFHNUQsaUJBQVksR0FBOEIsSUFBSSxZQUFZLEVBQWUsQ0FBQzs7OztRQUUxRSxjQUFTLEdBQWtDLElBQUksWUFBWSxFQUFtQixDQUFDOzs7O1FBRS9FLGVBQVUsR0FBdUIsSUFBSSxZQUFZLEVBQVEsQ0FBQzs7OztRQUUxRCxtQkFBYyxHQUF5QixJQUFJLFlBQVksRUFBVSxDQUFDOzs7O1FBRzVFLHlCQUFvQixHQUFzQixFQUFFLENBQUM7Ozs7UUFHN0MscUJBQWdCLEdBQVksS0FBSyxDQUFDOzs7O1FBTWpDLDBCQUFxQixHQUFXLENBQUMsQ0FBQyxDQUFDOzs7O1FBSW5D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Ozs7O0lBQzFCLHNDQUEwRjs7Ozs7SUFDMUYsbUNBQXlEOzs7OztJQUN6RCxzQ0FBb0Q7Ozs7O0lBR3BELGdDQUFvQzs7Ozs7SUFFcEMsaUNBQXFDOzs7OztJQUVyQyx1Q0FBNEY7Ozs7O0lBRTVGLDRDQUFrRDs7Ozs7SUFFbEQsc0NBQTZEOzs7OztJQUU3RCwyQ0FBa0Q7Ozs7O0lBRWxELG9DQUF1RTs7Ozs7SUFFdkUsdUNBQTZFOzs7OztJQUc3RSx1Q0FBMkY7Ozs7O0lBRTNGLG9DQUFnRzs7Ozs7SUFFaEcscUNBQTJFOzs7OztJQUUzRSx5Q0FBbUY7Ozs7O0lBR25GLCtDQUFvRDs7Ozs7SUFHcEQsMkNBQXlDOzs7Ozs7O0lBSXpDLDhDQUEwQzs7Ozs7O0lBRTFDLGdEQUEyQzs7Ozs7O0lBRTNDLG1EQUErQzs7Ozs7O0lBRS9DLHNDQUF3Qzs7Ozs7SUFDeEMsZ0NBQXVDOzs7Ozs7SUFFdkMsaUNBQXlDOzs7Ozs7SUFHekMsOENBQXVEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtBZnRlclZpZXdJbml0LCBDb21wb25lbnQsIEV2ZW50RW1pdHRlciwgSW5wdXQsIE9uRGVzdHJveSwgT3V0cHV0LCBWaWV3Q2hpbGR9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQge1dlYmNhbUluaXRFcnJvcn0gZnJvbSAnLi4vZG9tYWluL3dlYmNhbS1pbml0LWVycm9yJztcclxuaW1wb3J0IHtXZWJjYW1JbWFnZX0gZnJvbSAnLi4vZG9tYWluL3dlYmNhbS1pbWFnZSc7XHJcbmltcG9ydCB7T2JzZXJ2YWJsZSwgU3Vic2NyaXB0aW9ufSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHtXZWJjYW1VdGlsfSBmcm9tICcuLi91dGlsL3dlYmNhbS51dGlsJztcclxuaW1wb3J0IHtXZWJjYW1NaXJyb3JQcm9wZXJ0aWVzfSBmcm9tICcuLi9kb21haW4vd2ViY2FtLW1pcnJvci1wcm9wZXJ0aWVzJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAnd2ViY2FtJyxcclxuICB0ZW1wbGF0ZVVybDogJy4vd2ViY2FtLmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnLi93ZWJjYW0uY29tcG9uZW50LnNjc3MnXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgV2ViY2FtQ29tcG9uZW50IGltcGxlbWVudHMgQWZ0ZXJWaWV3SW5pdCwgT25EZXN0cm95IHtcclxuICBwcml2YXRlIHN0YXRpYyBERUZBVUxUX1ZJREVPX09QVElPTlM6IE1lZGlhVHJhY2tDb25zdHJhaW50cyA9IHtmYWNpbmdNb2RlOiAnZW52aXJvbm1lbnQnfTtcclxuICBwcml2YXRlIHN0YXRpYyBERUZBVUxUX0lNQUdFX1RZUEU6IHN0cmluZyA9ICdpbWFnZS9qcGVnJztcclxuICBwcml2YXRlIHN0YXRpYyBERUZBVUxUX0lNQUdFX1FVQUxJVFk6IG51bWJlciA9IDAuOTI7XHJcblxyXG4gIC8qKiBEZWZpbmVzIHRoZSBtYXggd2lkdGggb2YgdGhlIHdlYmNhbSBhcmVhIGluIHB4ICovXHJcbiAgQElucHV0KCkgcHVibGljIHdpZHRoOiBudW1iZXIgPSA2NDA7XHJcbiAgLyoqIERlZmluZXMgdGhlIG1heCBoZWlnaHQgb2YgdGhlIHdlYmNhbSBhcmVhIGluIHB4ICovXHJcbiAgQElucHV0KCkgcHVibGljIGhlaWdodDogbnVtYmVyID0gNDgwO1xyXG4gIC8qKiBEZWZpbmVzIGJhc2UgY29uc3RyYWludHMgdG8gYXBwbHkgd2hlbiByZXF1ZXN0aW5nIHZpZGVvIHRyYWNrIGZyb20gVXNlck1lZGlhICovXHJcbiAgQElucHV0KCkgcHVibGljIHZpZGVvT3B0aW9uczogTWVkaWFUcmFja0NvbnN0cmFpbnRzID0gV2ViY2FtQ29tcG9uZW50LkRFRkFVTFRfVklERU9fT1BUSU9OUztcclxuICAvKiogRmxhZyB0byBlbmFibGUvZGlzYWJsZSBjYW1lcmEgc3dpdGNoLiBJZiBlbmFibGVkLCBhIHN3aXRjaCBpY29uIHdpbGwgYmUgZGlzcGxheWVkIGlmIG11bHRpcGxlIGNhbWVyYXMgd2VyZSBmb3VuZCAqL1xyXG4gIEBJbnB1dCgpIHB1YmxpYyBhbGxvd0NhbWVyYVN3aXRjaDogYm9vbGVhbiA9IHRydWU7XHJcbiAgLyoqIFBhcmFtZXRlciB0byBjb250cm9sIGltYWdlIG1pcnJvcmluZyAoaS5lLiBmb3IgdXNlci1mYWNpbmcgY2FtZXJhKS4gW1wiYXV0b1wiLCBcImFsd2F5c1wiLCBcIm5ldmVyXCJdICovXHJcbiAgQElucHV0KCkgcHVibGljIG1pcnJvckltYWdlOiBzdHJpbmcgfCBXZWJjYW1NaXJyb3JQcm9wZXJ0aWVzO1xyXG4gIC8qKiBGbGFnIHRvIGNvbnRyb2wgd2hldGhlciBhbiBJbWFnZURhdGEgb2JqZWN0IGlzIHN0b3JlZCBpbnRvIHRoZSBXZWJjYW1JbWFnZSBvYmplY3QuICovXHJcbiAgQElucHV0KCkgcHVibGljIGNhcHR1cmVJbWFnZURhdGE6IGJvb2xlYW4gPSBmYWxzZTtcclxuICAvKiogVGhlIGltYWdlIHR5cGUgdG8gdXNlIHdoZW4gY2FwdHVyaW5nIHNuYXBzaG90cyAqL1xyXG4gIEBJbnB1dCgpIHB1YmxpYyBpbWFnZVR5cGU6IHN0cmluZyA9IFdlYmNhbUNvbXBvbmVudC5ERUZBVUxUX0lNQUdFX1RZUEU7XHJcbiAgLyoqIFRoZSBpbWFnZSBxdWFsaXR5IHRvIHVzZSB3aGVuIGNhcHR1cmluZyBzbmFwc2hvdHMgKG51bWJlciBiZXR3ZWVuIDAgYW5kIDEpICovXHJcbiAgQElucHV0KCkgcHVibGljIGltYWdlUXVhbGl0eTogbnVtYmVyID0gV2ViY2FtQ29tcG9uZW50LkRFRkFVTFRfSU1BR0VfUVVBTElUWTtcclxuXHJcbiAgLyoqIEV2ZW50RW1pdHRlciB3aGljaCBmaXJlcyB3aGVuIGFuIGltYWdlIGhhcyBiZWVuIGNhcHR1cmVkICovXHJcbiAgQE91dHB1dCgpIHB1YmxpYyBpbWFnZUNhcHR1cmU6IEV2ZW50RW1pdHRlcjxXZWJjYW1JbWFnZT4gPSBuZXcgRXZlbnRFbWl0dGVyPFdlYmNhbUltYWdlPigpO1xyXG4gIC8qKiBFbWl0cyBhIG1lZGlhRXJyb3IgaWYgd2ViY2FtIGNhbm5vdCBiZSBpbml0aWFsaXplZCAoZS5nLiBtaXNzaW5nIHVzZXIgcGVybWlzc2lvbnMpICovXHJcbiAgQE91dHB1dCgpIHB1YmxpYyBpbml0RXJyb3I6IEV2ZW50RW1pdHRlcjxXZWJjYW1Jbml0RXJyb3I+ID0gbmV3IEV2ZW50RW1pdHRlcjxXZWJjYW1Jbml0RXJyb3I+KCk7XHJcbiAgLyoqIEVtaXRzIHdoZW4gdGhlIHdlYmNhbSB2aWRlbyB3YXMgY2xpY2tlZCAqL1xyXG4gIEBPdXRwdXQoKSBwdWJsaWMgaW1hZ2VDbGljazogRXZlbnRFbWl0dGVyPHZvaWQ+ID0gbmV3IEV2ZW50RW1pdHRlcjx2b2lkPigpO1xyXG4gIC8qKiBFbWl0cyB0aGUgYWN0aXZlIGRldmljZUlkIGFmdGVyIHRoZSBhY3RpdmUgdmlkZW8gZGV2aWNlIHdhcyBzd2l0Y2hlZCAqL1xyXG4gIEBPdXRwdXQoKSBwdWJsaWMgY2FtZXJhU3dpdGNoZWQ6IEV2ZW50RW1pdHRlcjxzdHJpbmc+ID0gbmV3IEV2ZW50RW1pdHRlcjxzdHJpbmc+KCk7XHJcblxyXG4gIC8qKiBhdmFpbGFibGUgdmlkZW8gZGV2aWNlcyAqL1xyXG4gIHB1YmxpYyBhdmFpbGFibGVWaWRlb0lucHV0czogTWVkaWFEZXZpY2VJbmZvW10gPSBbXTtcclxuXHJcbiAgLyoqIEluZGljYXRlcyB3aGV0aGVyIHRoZSB2aWRlbyBkZXZpY2UgaXMgcmVhZHkgdG8gYmUgc3dpdGNoZWQgKi9cclxuICBwdWJsaWMgdmlkZW9Jbml0aWFsaXplZDogYm9vbGVhbiA9IGZhbHNlO1xyXG5cclxuICAvKiogSWYgdGhlIE9ic2VydmFibGUgcmVwcmVzZW50ZWQgYnkgdGhpcyBzdWJzY3JpcHRpb24gZW1pdHMsIGFuIGltYWdlIHdpbGwgYmUgY2FwdHVyZWQgYW5kIGVtaXR0ZWQgdGhyb3VnaFxyXG4gICAqIHRoZSAnaW1hZ2VDYXB0dXJlJyBFdmVudEVtaXR0ZXIgKi9cclxuICBwcml2YXRlIHRyaWdnZXJTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcclxuICAvKiogSW5kZXggb2YgYWN0aXZlIHZpZGVvIGluIGF2YWlsYWJsZVZpZGVvSW5wdXRzICovXHJcbiAgcHJpdmF0ZSBhY3RpdmVWaWRlb0lucHV0SW5kZXg6IG51bWJlciA9IC0xO1xyXG4gIC8qKiBTdWJzY3JpcHRpb24gdG8gc3dpdGNoQ2FtZXJhIGV2ZW50cyAqL1xyXG4gIHByaXZhdGUgc3dpdGNoQ2FtZXJhU3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XHJcbiAgLyoqIE1lZGlhU3RyZWFtIG9iamVjdCBpbiB1c2UgZm9yIHN0cmVhbWluZyBVc2VyTWVkaWEgZGF0YSAqL1xyXG4gIHByaXZhdGUgbWVkaWFTdHJlYW06IE1lZGlhU3RyZWFtID0gbnVsbDtcclxuICBAVmlld0NoaWxkKCd2aWRlbycpIHByaXZhdGUgdmlkZW86IGFueTtcclxuICAvKiogQ2FudmFzIGZvciBWaWRlbyBTbmFwc2hvdHMgKi9cclxuICBAVmlld0NoaWxkKCdjYW52YXMnKSBwcml2YXRlIGNhbnZhczogYW55O1xyXG5cclxuICAvKiogd2lkdGggYW5kIGhlaWdodCBvZiB0aGUgYWN0aXZlIHZpZGVvIHN0cmVhbSAqL1xyXG4gIHByaXZhdGUgYWN0aXZlVmlkZW9TZXR0aW5nczogTWVkaWFUcmFja1NldHRpbmdzID0gbnVsbDtcclxuXHJcbiAgLyoqXHJcbiAgICogSWYgdGhlIGdpdmVuIE9ic2VydmFibGUgZW1pdHMsIGFuIGltYWdlIHdpbGwgYmUgY2FwdHVyZWQgYW5kIGVtaXR0ZWQgdGhyb3VnaCAnaW1hZ2VDYXB0dXJlJyBFdmVudEVtaXR0ZXJcclxuICAgKi9cclxuICBASW5wdXQoKVxyXG4gIHB1YmxpYyBzZXQgdHJpZ2dlcih0cmlnZ2VyOiBPYnNlcnZhYmxlPHZvaWQ+KSB7XHJcbiAgICBpZiAodGhpcy50cmlnZ2VyU3Vic2NyaXB0aW9uKSB7XHJcbiAgICAgIHRoaXMudHJpZ2dlclN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFN1YnNjcmliZSB0byBldmVudHMgZnJvbSB0aGlzIE9ic2VydmFibGUgdG8gdGFrZSBzbmFwc2hvdHNcclxuICAgIHRoaXMudHJpZ2dlclN1YnNjcmlwdGlvbiA9IHRyaWdnZXIuc3Vic2NyaWJlKCgpID0+IHtcclxuICAgICAgdGhpcy50YWtlU25hcHNob3QoKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogSWYgdGhlIGdpdmVuIE9ic2VydmFibGUgZW1pdHMsIHRoZSBhY3RpdmUgd2ViY2FtIHdpbGwgYmUgc3dpdGNoZWQgdG8gdGhlIG9uZSBpbmRpY2F0ZWQgYnkgdGhlIGVtaXR0ZWQgdmFsdWUuXHJcbiAgICogQHBhcmFtIHN3aXRjaENhbWVyYSBJbmRpY2F0ZXMgd2hpY2ggd2ViY2FtIHRvIHN3aXRjaCB0b1xyXG4gICAqICAgdHJ1ZTogY3ljbGUgZm9yd2FyZHMgdGhyb3VnaCBhdmFpbGFibGUgd2ViY2Ftc1xyXG4gICAqICAgZmFsc2U6IGN5Y2xlIGJhY2t3YXJkcyB0aHJvdWdoIGF2YWlsYWJsZSB3ZWJjYW1zXHJcbiAgICogICBzdHJpbmc6IGFjdGl2YXRlIHRoZSB3ZWJjYW0gd2l0aCB0aGUgZ2l2ZW4gaWRcclxuICAgKi9cclxuICBASW5wdXQoKVxyXG4gIHB1YmxpYyBzZXQgc3dpdGNoQ2FtZXJhKHN3aXRjaENhbWVyYTogT2JzZXJ2YWJsZTxib29sZWFuIHwgc3RyaW5nPikge1xyXG4gICAgaWYgKHRoaXMuc3dpdGNoQ2FtZXJhU3Vic2NyaXB0aW9uKSB7XHJcbiAgICAgIHRoaXMuc3dpdGNoQ2FtZXJhU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gU3Vic2NyaWJlIHRvIGV2ZW50cyBmcm9tIHRoaXMgT2JzZXJ2YWJsZSB0byBzd2l0Y2ggdmlkZW8gZGV2aWNlXHJcbiAgICB0aGlzLnN3aXRjaENhbWVyYVN1YnNjcmlwdGlvbiA9IHN3aXRjaENhbWVyYS5zdWJzY3JpYmUoKHZhbHVlOiBib29sZWFuIHwgc3RyaW5nKSA9PiB7XHJcbiAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgLy8gZGV2aWNlSWQgd2FzIHNwZWNpZmllZFxyXG4gICAgICAgIHRoaXMuc3dpdGNoVG9WaWRlb0lucHV0KHZhbHVlKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBkaXJlY3Rpb24gd2FzIHNwZWNpZmllZFxyXG4gICAgICAgIHRoaXMucm90YXRlVmlkZW9JbnB1dCh2YWx1ZSAhPT0gZmFsc2UpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCBNZWRpYVRyYWNrQ29uc3RyYWludHMgdG8gcmVxdWVzdCBzdHJlYW1pbmcgdGhlIGdpdmVuIGRldmljZVxyXG4gICAqIEBwYXJhbSBkZXZpY2VJZFxyXG4gICAqIEBwYXJhbSBiYXNlTWVkaWFUcmFja0NvbnN0cmFpbnRzIGJhc2UgY29uc3RyYWludHMgdG8gbWVyZ2UgZGV2aWNlSWQtY29uc3RyYWludCBpbnRvXHJcbiAgICogQHJldHVybnNcclxuICAgKi9cclxuICBwcml2YXRlIHN0YXRpYyBnZXRNZWRpYUNvbnN0cmFpbnRzRm9yRGV2aWNlKGRldmljZUlkOiBzdHJpbmcsIGJhc2VNZWRpYVRyYWNrQ29uc3RyYWludHM6IE1lZGlhVHJhY2tDb25zdHJhaW50cyk6IE1lZGlhVHJhY2tDb25zdHJhaW50cyB7XHJcbiAgICBjb25zdCByZXN1bHQ6IE1lZGlhVHJhY2tDb25zdHJhaW50cyA9IGJhc2VNZWRpYVRyYWNrQ29uc3RyYWludHMgPyBiYXNlTWVkaWFUcmFja0NvbnN0cmFpbnRzIDogdGhpcy5ERUZBVUxUX1ZJREVPX09QVElPTlM7XHJcbiAgICBpZiAoZGV2aWNlSWQpIHtcclxuICAgICAgcmVzdWx0LmRldmljZUlkID0ge2V4YWN0OiBkZXZpY2VJZH07XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFRyaWVzIHRvIGhhcnZlc3QgdGhlIGRldmljZUlkIGZyb20gdGhlIGdpdmVuIG1lZGlhU3RyZWFtVHJhY2sgb2JqZWN0LlxyXG4gICAqIEJyb3dzZXJzIHBvcHVsYXRlIHRoaXMgb2JqZWN0IGRpZmZlcmVudGx5OyB0aGlzIG1ldGhvZCB0cmllcyBzb21lIGRpZmZlcmVudCBhcHByb2FjaGVzXHJcbiAgICogdG8gcmVhZCB0aGUgaWQuXHJcbiAgICogQHBhcmFtIG1lZGlhU3RyZWFtVHJhY2tcclxuICAgKiBAcmV0dXJucyBkZXZpY2VJZCBpZiBmb3VuZCBpbiB0aGUgbWVkaWFTdHJlYW1UcmFja1xyXG4gICAqL1xyXG4gIHByaXZhdGUgc3RhdGljIGdldERldmljZUlkRnJvbU1lZGlhU3RyZWFtVHJhY2sobWVkaWFTdHJlYW1UcmFjazogTWVkaWFTdHJlYW1UcmFjayk6IHN0cmluZyB7XHJcbiAgICBpZiAobWVkaWFTdHJlYW1UcmFjay5nZXRTZXR0aW5ncyAmJiBtZWRpYVN0cmVhbVRyYWNrLmdldFNldHRpbmdzKCkgJiYgbWVkaWFTdHJlYW1UcmFjay5nZXRTZXR0aW5ncygpLmRldmljZUlkKSB7XHJcbiAgICAgIHJldHVybiBtZWRpYVN0cmVhbVRyYWNrLmdldFNldHRpbmdzKCkuZGV2aWNlSWQ7XHJcbiAgICB9IGVsc2UgaWYgKG1lZGlhU3RyZWFtVHJhY2suZ2V0Q29uc3RyYWludHMgJiYgbWVkaWFTdHJlYW1UcmFjay5nZXRDb25zdHJhaW50cygpICYmIG1lZGlhU3RyZWFtVHJhY2suZ2V0Q29uc3RyYWludHMoKS5kZXZpY2VJZCkge1xyXG4gICAgICBjb25zdCBkZXZpY2VJZE9iajogQ29uc3RyYWluRE9NU3RyaW5nID0gbWVkaWFTdHJlYW1UcmFjay5nZXRDb25zdHJhaW50cygpLmRldmljZUlkO1xyXG4gICAgICByZXR1cm4gV2ViY2FtQ29tcG9uZW50LmdldFZhbHVlRnJvbUNvbnN0cmFpbkRPTVN0cmluZyhkZXZpY2VJZE9iaik7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBUcmllcyB0byBoYXJ2ZXN0IHRoZSBmYWNpbmdNb2RlIGZyb20gdGhlIGdpdmVuIG1lZGlhU3RyZWFtVHJhY2sgb2JqZWN0LlxyXG4gICAqIEJyb3dzZXJzIHBvcHVsYXRlIHRoaXMgb2JqZWN0IGRpZmZlcmVudGx5OyB0aGlzIG1ldGhvZCB0cmllcyBzb21lIGRpZmZlcmVudCBhcHByb2FjaGVzXHJcbiAgICogdG8gcmVhZCB0aGUgdmFsdWUuXHJcbiAgICogQHBhcmFtIG1lZGlhU3RyZWFtVHJhY2tcclxuICAgKiBAcmV0dXJucyBmYWNpbmdNb2RlIGlmIGZvdW5kIGluIHRoZSBtZWRpYVN0cmVhbVRyYWNrXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzdGF0aWMgZ2V0RmFjaW5nTW9kZUZyb21NZWRpYVN0cmVhbVRyYWNrKG1lZGlhU3RyZWFtVHJhY2s6IE1lZGlhU3RyZWFtVHJhY2spOiBzdHJpbmcge1xyXG4gICAgaWYgKG1lZGlhU3RyZWFtVHJhY2spIHtcclxuICAgICAgaWYgKG1lZGlhU3RyZWFtVHJhY2suZ2V0U2V0dGluZ3MgJiYgbWVkaWFTdHJlYW1UcmFjay5nZXRTZXR0aW5ncygpICYmIG1lZGlhU3RyZWFtVHJhY2suZ2V0U2V0dGluZ3MoKS5mYWNpbmdNb2RlKSB7XHJcbiAgICAgICAgcmV0dXJuIG1lZGlhU3RyZWFtVHJhY2suZ2V0U2V0dGluZ3MoKS5mYWNpbmdNb2RlO1xyXG4gICAgICB9IGVsc2UgaWYgKG1lZGlhU3RyZWFtVHJhY2suZ2V0Q29uc3RyYWludHMgJiYgbWVkaWFTdHJlYW1UcmFjay5nZXRDb25zdHJhaW50cygpICYmIG1lZGlhU3RyZWFtVHJhY2suZ2V0Q29uc3RyYWludHMoKS5mYWNpbmdNb2RlKSB7XHJcbiAgICAgICAgY29uc3QgZmFjaW5nTW9kZUNvbnN0cmFpbnQ6IENvbnN0cmFpbkRPTVN0cmluZyA9IG1lZGlhU3RyZWFtVHJhY2suZ2V0Q29uc3RyYWludHMoKS5mYWNpbmdNb2RlO1xyXG4gICAgICAgIHJldHVybiBXZWJjYW1Db21wb25lbnQuZ2V0VmFsdWVGcm9tQ29uc3RyYWluRE9NU3RyaW5nKGZhY2luZ01vZGVDb25zdHJhaW50KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRGV0ZXJtaW5lcyB3aGV0aGVyIHRoZSBnaXZlbiBtZWRpYVN0cmVhbVRyYWNrIGNsYWltcyBpdHNlbGYgYXMgdXNlciBmYWNpbmdcclxuICAgKiBAcGFyYW0gbWVkaWFTdHJlYW1UcmFja1xyXG4gICAqL1xyXG4gIHByaXZhdGUgc3RhdGljIGlzVXNlckZhY2luZyhtZWRpYVN0cmVhbVRyYWNrOiBNZWRpYVN0cmVhbVRyYWNrKTogYm9vbGVhbiB7XHJcbiAgICBjb25zdCBmYWNpbmdNb2RlOiBzdHJpbmcgPSBXZWJjYW1Db21wb25lbnQuZ2V0RmFjaW5nTW9kZUZyb21NZWRpYVN0cmVhbVRyYWNrKG1lZGlhU3RyZWFtVHJhY2spO1xyXG4gICAgcmV0dXJuIGZhY2luZ01vZGUgPyAndXNlcicgPT09IGZhY2luZ01vZGUudG9Mb3dlckNhc2UoKSA6IGZhbHNlO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRXh0cmFjdHMgdGhlIHZhbHVlIGZyb20gdGhlIGdpdmVuIENvbnN0cmFpbkRPTVN0cmluZ1xyXG4gICAqIEBwYXJhbSBjb25zdHJhaW5ET01TdHJpbmdcclxuICAgKi9cclxuICBwcml2YXRlIHN0YXRpYyBnZXRWYWx1ZUZyb21Db25zdHJhaW5ET01TdHJpbmcoY29uc3RyYWluRE9NU3RyaW5nOiBDb25zdHJhaW5ET01TdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgaWYgKGNvbnN0cmFpbkRPTVN0cmluZykge1xyXG4gICAgICBpZiAoY29uc3RyYWluRE9NU3RyaW5nIGluc3RhbmNlb2YgU3RyaW5nKSB7XHJcbiAgICAgICAgcmV0dXJuIFN0cmluZyhjb25zdHJhaW5ET01TdHJpbmcpO1xyXG4gICAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkoY29uc3RyYWluRE9NU3RyaW5nKSAmJiBBcnJheShjb25zdHJhaW5ET01TdHJpbmcpLmxlbmd0aCA+IDApIHtcclxuICAgICAgICByZXR1cm4gU3RyaW5nKGNvbnN0cmFpbkRPTVN0cmluZ1swXSk7XHJcbiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGNvbnN0cmFpbkRPTVN0cmluZyA9PT0gJ29iamVjdCcpIHtcclxuICAgICAgICBpZiAoY29uc3RyYWluRE9NU3RyaW5nWydleGFjdCddKSB7XHJcbiAgICAgICAgICByZXR1cm4gU3RyaW5nKGNvbnN0cmFpbkRPTVN0cmluZ1snZXhhY3QnXSk7XHJcbiAgICAgICAgfSBlbHNlIGlmIChjb25zdHJhaW5ET01TdHJpbmdbJ2lkZWFsJ10pIHtcclxuICAgICAgICAgIHJldHVybiBTdHJpbmcoY29uc3RyYWluRE9NU3RyaW5nWydpZGVhbCddKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBuZ0FmdGVyVmlld0luaXQoKTogdm9pZCB7XHJcbiAgICB0aGlzLmRldGVjdEF2YWlsYWJsZURldmljZXMoKVxyXG4gICAgICAudGhlbigoZGV2aWNlczogTWVkaWFEZXZpY2VJbmZvW10pID0+IHtcclxuICAgICAgICAvLyBzdGFydCBmaXJzdCBkZXZpY2VcclxuICAgICAgICB0aGlzLnN3aXRjaFRvVmlkZW9JbnB1dChkZXZpY2VzLmxlbmd0aCA+IDAgPyBkZXZpY2VzWzBdLmRldmljZUlkIDogbnVsbCk7XHJcbiAgICAgIH0pXHJcbiAgICAgIC5jYXRjaCgoZXJyOiBzdHJpbmcpID0+IHtcclxuICAgICAgICB0aGlzLmluaXRFcnJvci5uZXh0KDxXZWJjYW1Jbml0RXJyb3I+e21lc3NhZ2U6IGVycn0pO1xyXG4gICAgICAgIC8vIGZhbGxiYWNrOiBzdGlsbCB0cnkgdG8gbG9hZCB3ZWJjYW0sIGV2ZW4gaWYgZGV2aWNlIGVudW1lcmF0aW9uIGZhaWxlZFxyXG4gICAgICAgIHRoaXMuc3dpdGNoVG9WaWRlb0lucHV0KG51bGwpO1xyXG4gICAgICB9KTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBuZ09uRGVzdHJveSgpOiB2b2lkIHtcclxuICAgIHRoaXMuc3RvcE1lZGlhVHJhY2tzKCk7XHJcbiAgICB0aGlzLnVuc3Vic2NyaWJlRnJvbVN1YnNjcmlwdGlvbnMoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFRha2VzIGEgc25hcHNob3Qgb2YgdGhlIGN1cnJlbnQgd2ViY2FtJ3MgdmlldyBhbmQgZW1pdHMgdGhlIGltYWdlIGFzIGFuIGV2ZW50XHJcbiAgICovXHJcbiAgcHVibGljIHRha2VTbmFwc2hvdCgpOiB2b2lkIHtcclxuICAgIC8vIHNldCBjYW52YXMgc2l6ZSB0byBhY3R1YWwgdmlkZW8gc2l6ZVxyXG4gICAgY29uc3QgX3ZpZGVvID0gdGhpcy52aWRlby5uYXRpdmVFbGVtZW50O1xyXG4gICAgY29uc3QgZGltZW5zaW9ucyA9IHt3aWR0aDogdGhpcy53aWR0aCwgaGVpZ2h0OiB0aGlzLmhlaWdodH07XHJcbiAgICBpZiAoX3ZpZGVvLnZpZGVvV2lkdGgpIHtcclxuICAgICAgZGltZW5zaW9ucy53aWR0aCA9IF92aWRlby52aWRlb1dpZHRoO1xyXG4gICAgICBkaW1lbnNpb25zLmhlaWdodCA9IF92aWRlby52aWRlb0hlaWdodDtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBfY2FudmFzID0gdGhpcy5jYW52YXMubmF0aXZlRWxlbWVudDtcclxuICAgIF9jYW52YXMud2lkdGggPSBkaW1lbnNpb25zLndpZHRoO1xyXG4gICAgX2NhbnZhcy5oZWlnaHQgPSBkaW1lbnNpb25zLmhlaWdodDtcclxuXHJcbiAgICAvLyBwYWludCBzbmFwc2hvdCBpbWFnZSB0byBjYW52YXNcclxuICAgIGNvbnN0IGNvbnRleHQyZCA9IF9jYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcclxuICAgIGNvbnRleHQyZC5kcmF3SW1hZ2UodGhpcy52aWRlby5uYXRpdmVFbGVtZW50LCAwLCAwKTtcclxuXHJcbiAgICAvLyByZWFkIGNhbnZhcyBjb250ZW50IGFzIGltYWdlXHJcbiAgICBjb25zdCBtaW1lVHlwZTogc3RyaW5nID0gdGhpcy5pbWFnZVR5cGUgPyB0aGlzLmltYWdlVHlwZSA6IFdlYmNhbUNvbXBvbmVudC5ERUZBVUxUX0lNQUdFX1RZUEU7XHJcbiAgICBjb25zdCBxdWFsaXR5OiBudW1iZXIgPSB0aGlzLmltYWdlUXVhbGl0eSA/IHRoaXMuaW1hZ2VRdWFsaXR5IDogV2ViY2FtQ29tcG9uZW50LkRFRkFVTFRfSU1BR0VfUVVBTElUWTtcclxuICAgIGNvbnN0IGRhdGFVcmw6IHN0cmluZyA9IF9jYW52YXMudG9EYXRhVVJMKG1pbWVUeXBlLCBxdWFsaXR5KTtcclxuXHJcbiAgICAvLyBnZXQgdGhlIEltYWdlRGF0YSBvYmplY3QgZnJvbSB0aGUgY2FudmFzJyBjb250ZXh0LlxyXG4gICAgbGV0IGltYWdlRGF0YTogSW1hZ2VEYXRhID0gbnVsbDtcclxuXHJcbiAgICBpZiAodGhpcy5jYXB0dXJlSW1hZ2VEYXRhKSB7XHJcbiAgICAgIGltYWdlRGF0YSA9IGNvbnRleHQyZC5nZXRJbWFnZURhdGEoMCwgMCwgX2NhbnZhcy53aWR0aCwgX2NhbnZhcy5oZWlnaHQpO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuaW1hZ2VDYXB0dXJlLm5leHQobmV3IFdlYmNhbUltYWdlKGRhdGFVcmwsIG1pbWVUeXBlLCBpbWFnZURhdGEpKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFN3aXRjaGVzIHRvIHRoZSBuZXh0L3ByZXZpb3VzIHZpZGVvIGRldmljZVxyXG4gICAqIEBwYXJhbSBmb3J3YXJkXHJcbiAgICovXHJcbiAgcHVibGljIHJvdGF0ZVZpZGVvSW5wdXQoZm9yd2FyZDogYm9vbGVhbikge1xyXG4gICAgaWYgKHRoaXMuYXZhaWxhYmxlVmlkZW9JbnB1dHMgJiYgdGhpcy5hdmFpbGFibGVWaWRlb0lucHV0cy5sZW5ndGggPiAxKSB7XHJcbiAgICAgIGNvbnN0IGluY3JlbWVudDogbnVtYmVyID0gZm9yd2FyZCA/IDEgOiAodGhpcy5hdmFpbGFibGVWaWRlb0lucHV0cy5sZW5ndGggLSAxKTtcclxuICAgICAgY29uc3QgbmV4dElucHV0SW5kZXggPSAodGhpcy5hY3RpdmVWaWRlb0lucHV0SW5kZXggKyBpbmNyZW1lbnQpICUgdGhpcy5hdmFpbGFibGVWaWRlb0lucHV0cy5sZW5ndGg7XHJcbiAgICAgIHRoaXMuc3dpdGNoVG9WaWRlb0lucHV0KHRoaXMuYXZhaWxhYmxlVmlkZW9JbnB1dHNbbmV4dElucHV0SW5kZXhdLmRldmljZUlkKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFN3aXRjaGVzIHRoZSBjYW1lcmEtdmlldyB0byB0aGUgc3BlY2lmaWVkIHZpZGVvIGRldmljZVxyXG4gICAqL1xyXG4gIHB1YmxpYyBzd2l0Y2hUb1ZpZGVvSW5wdXQoZGV2aWNlSWQ6IHN0cmluZyk6IHZvaWQge1xyXG4gICAgdGhpcy52aWRlb0luaXRpYWxpemVkID0gZmFsc2U7XHJcbiAgICB0aGlzLnN0b3BNZWRpYVRyYWNrcygpO1xyXG4gICAgdGhpcy5pbml0V2ViY2FtKGRldmljZUlkLCB0aGlzLnZpZGVvT3B0aW9ucyk7XHJcbiAgfVxyXG5cclxuXHJcbiAgLyoqXHJcbiAgICogRXZlbnQtaGFuZGxlciBmb3IgdmlkZW8gcmVzaXplIGV2ZW50LlxyXG4gICAqIFRyaWdnZXJzIEFuZ3VsYXIgY2hhbmdlIGRldGVjdGlvbiBzbyB0aGF0IG5ldyB2aWRlbyBkaW1lbnNpb25zIGdldCBhcHBsaWVkXHJcbiAgICovXHJcbiAgcHVibGljIHZpZGVvUmVzaXplKCk6IHZvaWQge1xyXG4gICAgLy8gaGVyZSB0byB0cmlnZ2VyIEFuZ3VsYXIgY2hhbmdlIGRldGVjdGlvblxyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldCB2aWRlb1dpZHRoKCkge1xyXG4gICAgY29uc3QgdmlkZW9SYXRpbyA9IHRoaXMuZ2V0VmlkZW9Bc3BlY3RSYXRpbygpO1xyXG4gICAgcmV0dXJuIE1hdGgubWluKHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0ICogdmlkZW9SYXRpbyk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0IHZpZGVvSGVpZ2h0KCkge1xyXG4gICAgY29uc3QgdmlkZW9SYXRpbyA9IHRoaXMuZ2V0VmlkZW9Bc3BlY3RSYXRpbygpO1xyXG4gICAgcmV0dXJuIE1hdGgubWluKHRoaXMuaGVpZ2h0LCB0aGlzLndpZHRoIC8gdmlkZW9SYXRpbyk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0IHZpZGVvU3R5bGVDbGFzc2VzKCkge1xyXG4gICAgbGV0IGNsYXNzZXM6IHN0cmluZyA9ICcnO1xyXG5cclxuICAgIGlmICh0aGlzLmlzTWlycm9ySW1hZ2UoKSkge1xyXG4gICAgICBjbGFzc2VzICs9ICdtaXJyb3JlZCAnO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBjbGFzc2VzLnRyaW0oKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJldHVybnMgdGhlIHZpZGVvIGFzcGVjdCByYXRpbyBvZiB0aGUgYWN0aXZlIHZpZGVvIHN0cmVhbVxyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0VmlkZW9Bc3BlY3RSYXRpbygpOiBudW1iZXIge1xyXG4gICAgLy8gY2FsY3VsYXRlIHJhdGlvIGZyb20gdmlkZW8gZWxlbWVudCBkaW1lbnNpb25zIGlmIHByZXNlbnRcclxuICAgIGNvbnN0IHZpZGVvRWxlbWVudCA9IHRoaXMudmlkZW8ubmF0aXZlRWxlbWVudDtcclxuICAgIGlmICh2aWRlb0VsZW1lbnQudmlkZW9XaWR0aCAmJiB2aWRlb0VsZW1lbnQudmlkZW9XaWR0aCA+IDAgJiZcclxuICAgICAgdmlkZW9FbGVtZW50LnZpZGVvSGVpZ2h0ICYmIHZpZGVvRWxlbWVudC52aWRlb0hlaWdodCA+IDApIHtcclxuXHJcbiAgICAgIHJldHVybiB2aWRlb0VsZW1lbnQudmlkZW9XaWR0aCAvIHZpZGVvRWxlbWVudC52aWRlb0hlaWdodDtcclxuICAgIH1cclxuXHJcbiAgICAvLyBub3RoaW5nIHByZXNlbnQgLSBjYWxjdWxhdGUgcmF0aW8gYmFzZWQgb24gd2lkdGgvaGVpZ2h0IHBhcmFtc1xyXG4gICAgcmV0dXJuIHRoaXMud2lkdGggLyB0aGlzLmhlaWdodDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEluaXQgd2ViY2FtIGxpdmUgdmlld1xyXG4gICAqL1xyXG4gIHByaXZhdGUgaW5pdFdlYmNhbShkZXZpY2VJZDogc3RyaW5nLCB1c2VyVmlkZW9UcmFja0NvbnN0cmFpbnRzOiBNZWRpYVRyYWNrQ29uc3RyYWludHMpIHtcclxuICAgIGNvbnN0IF92aWRlbyA9IHRoaXMudmlkZW8ubmF0aXZlRWxlbWVudDtcclxuICAgIGlmIChuYXZpZ2F0b3IubWVkaWFEZXZpY2VzICYmIG5hdmlnYXRvci5tZWRpYURldmljZXMuZ2V0VXNlck1lZGlhKSB7XHJcblxyXG4gICAgICAvLyBtZXJnZSBkZXZpY2VJZCAtPiB1c2VyVmlkZW9UcmFja0NvbnN0cmFpbnRzXHJcbiAgICAgIGNvbnN0IHZpZGVvVHJhY2tDb25zdHJhaW50cyA9IFdlYmNhbUNvbXBvbmVudC5nZXRNZWRpYUNvbnN0cmFpbnRzRm9yRGV2aWNlKGRldmljZUlkLCB1c2VyVmlkZW9UcmFja0NvbnN0cmFpbnRzKTtcclxuXHJcbiAgICAgIG5hdmlnYXRvci5tZWRpYURldmljZXMuZ2V0VXNlck1lZGlhKDxNZWRpYVN0cmVhbUNvbnN0cmFpbnRzPnt2aWRlbzogdmlkZW9UcmFja0NvbnN0cmFpbnRzfSlcclxuICAgICAgICAudGhlbigoc3RyZWFtOiBNZWRpYVN0cmVhbSkgPT4ge1xyXG4gICAgICAgICAgdGhpcy5tZWRpYVN0cmVhbSA9IHN0cmVhbTtcclxuICAgICAgICAgIF92aWRlby5zcmNPYmplY3QgPSBzdHJlYW07XHJcbiAgICAgICAgICBfdmlkZW8ucGxheSgpO1xyXG5cclxuICAgICAgICAgIHRoaXMuYWN0aXZlVmlkZW9TZXR0aW5ncyA9IHN0cmVhbS5nZXRWaWRlb1RyYWNrcygpWzBdLmdldFNldHRpbmdzKCk7XHJcbiAgICAgICAgICBjb25zdCBhY3RpdmVEZXZpY2VJZDogc3RyaW5nID0gV2ViY2FtQ29tcG9uZW50LmdldERldmljZUlkRnJvbU1lZGlhU3RyZWFtVHJhY2soc3RyZWFtLmdldFZpZGVvVHJhY2tzKClbMF0pO1xyXG4gICAgICAgICAgdGhpcy5hY3RpdmVWaWRlb0lucHV0SW5kZXggPSBhY3RpdmVEZXZpY2VJZCA/IHRoaXMuYXZhaWxhYmxlVmlkZW9JbnB1dHNcclxuICAgICAgICAgICAgLmZpbmRJbmRleCgobWVkaWFEZXZpY2VJbmZvOiBNZWRpYURldmljZUluZm8pID0+IG1lZGlhRGV2aWNlSW5mby5kZXZpY2VJZCA9PT0gYWN0aXZlRGV2aWNlSWQpIDogLTE7XHJcbiAgICAgICAgICB0aGlzLnZpZGVvSW5pdGlhbGl6ZWQgPSB0cnVlO1xyXG5cclxuICAgICAgICAgIHRoaXMuY2FtZXJhU3dpdGNoZWQubmV4dChhY3RpdmVEZXZpY2VJZCk7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAuY2F0Y2goKGVycjogTWVkaWFTdHJlYW1FcnJvcikgPT4ge1xyXG4gICAgICAgICAgdGhpcy5pbml0RXJyb3IubmV4dCg8V2ViY2FtSW5pdEVycm9yPnttZXNzYWdlOiBlcnIubWVzc2FnZSwgbWVkaWFTdHJlYW1FcnJvcjogZXJyfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLmluaXRFcnJvci5uZXh0KDxXZWJjYW1Jbml0RXJyb3I+e21lc3NhZ2U6ICdDYW5ub3QgcmVhZCBVc2VyTWVkaWEgZnJvbSBNZWRpYURldmljZXMuJ30pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZXRBY3RpdmVWaWRlb1RyYWNrKCk6IE1lZGlhU3RyZWFtVHJhY2sge1xyXG4gICAgcmV0dXJuIHRoaXMubWVkaWFTdHJlYW0gPyB0aGlzLm1lZGlhU3RyZWFtLmdldFZpZGVvVHJhY2tzKClbMF0gOiBudWxsO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBpc01pcnJvckltYWdlKCk6IGJvb2xlYW4ge1xyXG4gICAgaWYgKCF0aGlzLmdldEFjdGl2ZVZpZGVvVHJhY2soKSkge1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gY2hlY2sgZm9yIGV4cGxpY2l0IG1pcnJvciBvdmVycmlkZSBwYXJhbWV0ZXJcclxuICAgIHtcclxuICAgICAgbGV0IG1pcnJvcjogc3RyaW5nID0gJ2F1dG8nO1xyXG4gICAgICBpZiAodGhpcy5taXJyb3JJbWFnZSkge1xyXG4gICAgICAgIGlmICh0eXBlb2YgdGhpcy5taXJyb3JJbWFnZSA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgIG1pcnJvciA9IFN0cmluZyh0aGlzLm1pcnJvckltYWdlKS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAvLyBXZWJjYW1NaXJyb3JQcm9wZXJ0aWVzXHJcbiAgICAgICAgICBpZiAodGhpcy5taXJyb3JJbWFnZS54KSB7XHJcbiAgICAgICAgICAgIG1pcnJvciA9IHRoaXMubWlycm9ySW1hZ2UueC50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgc3dpdGNoIChtaXJyb3IpIHtcclxuICAgICAgICBjYXNlICdhbHdheXMnOlxyXG4gICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgY2FzZSAnbmV2ZXInOlxyXG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gZGVmYXVsdDogZW5hYmxlIG1pcnJvcmluZyBpZiB3ZWJjYW0gaXMgdXNlciBmYWNpbmdcclxuICAgIHJldHVybiBXZWJjYW1Db21wb25lbnQuaXNVc2VyRmFjaW5nKHRoaXMuZ2V0QWN0aXZlVmlkZW9UcmFjaygpKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFN0b3BzIGFsbCBhY3RpdmUgbWVkaWEgdHJhY2tzLlxyXG4gICAqIFRoaXMgcHJldmVudHMgdGhlIHdlYmNhbSBmcm9tIGJlaW5nIGluZGljYXRlZCBhcyBhY3RpdmUsXHJcbiAgICogZXZlbiBpZiBpdCBpcyBubyBsb25nZXIgdXNlZCBieSB0aGlzIGNvbXBvbmVudC5cclxuICAgKi9cclxuICBwcml2YXRlIHN0b3BNZWRpYVRyYWNrcygpIHtcclxuICAgIGlmICh0aGlzLm1lZGlhU3RyZWFtICYmIHRoaXMubWVkaWFTdHJlYW0uZ2V0VHJhY2tzKSB7XHJcbiAgICAgIC8vIGdldFRyYWNrcygpIHJldHVybnMgYWxsIG1lZGlhIHRyYWNrcyAodmlkZW8rYXVkaW8pXHJcbiAgICAgIHRoaXMubWVkaWFTdHJlYW0uZ2V0VHJhY2tzKClcclxuICAgICAgICAuZm9yRWFjaCgodHJhY2s6IE1lZGlhU3RyZWFtVHJhY2spID0+IHRyYWNrLnN0b3AoKSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBVbnN1YnNjcmliZSBmcm9tIGFsbCBvcGVuIHN1YnNjcmlwdGlvbnNcclxuICAgKi9cclxuICBwcml2YXRlIHVuc3Vic2NyaWJlRnJvbVN1YnNjcmlwdGlvbnMoKSB7XHJcbiAgICBpZiAodGhpcy50cmlnZ2VyU3Vic2NyaXB0aW9uKSB7XHJcbiAgICAgIHRoaXMudHJpZ2dlclN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMuc3dpdGNoQ2FtZXJhU3Vic2NyaXB0aW9uKSB7XHJcbiAgICAgIHRoaXMuc3dpdGNoQ2FtZXJhU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZWFkcyBhdmFpbGFibGUgaW5wdXQgZGV2aWNlc1xyXG4gICAqL1xyXG4gIHByaXZhdGUgZGV0ZWN0QXZhaWxhYmxlRGV2aWNlcygpOiBQcm9taXNlPE1lZGlhRGV2aWNlSW5mb1tdPiB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICBXZWJjYW1VdGlsLmdldEF2YWlsYWJsZVZpZGVvSW5wdXRzKClcclxuICAgICAgICAudGhlbigoZGV2aWNlczogTWVkaWFEZXZpY2VJbmZvW10pID0+IHtcclxuICAgICAgICAgIHRoaXMuYXZhaWxhYmxlVmlkZW9JbnB1dHMgPSBkZXZpY2VzO1xyXG4gICAgICAgICAgcmVzb2x2ZShkZXZpY2VzKTtcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5jYXRjaChlcnIgPT4ge1xyXG4gICAgICAgICAgdGhpcy5hdmFpbGFibGVWaWRlb0lucHV0cyA9IFtdO1xyXG4gICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG59XHJcbiJdfQ==