/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, EventEmitter, Input, Output, ViewChild } from '@angular/core';
import { WebcamImage } from '../domain/webcam-image';
import { Observable } from 'rxjs';
import { WebcamUtil } from '../util/webcam.util';
export class WebcamComponent {
    constructor() {
        /**
         * Defines the max width of the webcam area in px
         */
        this.width = 640;
        /**
         * Defines the max height of the webcam area in px
         */
        this.height = 480;
        /**
         * Defines base constraints to apply when requesting video track from UserMedia
         */
        this.videoOptions = WebcamComponent.DEFAULT_VIDEO_OPTIONS;
        /**
         * Flag to enable/disable camera switch. If enabled, a switch icon will be displayed if multiple cameras were found
         */
        this.allowCameraSwitch = true;
        /**
         * Flag to control whether an ImageData object is stored into the WebcamImage object.
         */
        this.captureImageData = false;
        /**
         * The image type to use when capturing snapshots
         */
        this.imageType = WebcamComponent.DEFAULT_IMAGE_TYPE;
        /**
         * The image quality to use when capturing snapshots (number between 0 and 1)
         */
        this.imageQuality = WebcamComponent.DEFAULT_IMAGE_QUALITY;
        /**
         * EventEmitter which fires when an image has been captured
         */
        this.imageCapture = new EventEmitter();
        /**
         * Emits a mediaError if webcam cannot be initialized (e.g. missing user permissions)
         */
        this.initError = new EventEmitter();
        /**
         * Emits when the webcam video was clicked
         */
        this.imageClick = new EventEmitter();
        /**
         * Emits the active deviceId after the active video device was switched
         */
        this.cameraSwitched = new EventEmitter();
        /**
         * available video devices
         */
        this.availableVideoInputs = [];
        /**
         * Indicates whether the video device is ready to be switched
         */
        this.videoInitialized = false;
        /**
         * Index of active video in availableVideoInputs
         */
        this.activeVideoInputIndex = -1;
        /**
         * MediaStream object in use for streaming UserMedia data
         */
        this.mediaStream = null;
        /**
         * width and height of the active video stream
         */
        this.activeVideoSettings = null;
    }
    /**
     * If the given Observable emits, an image will be captured and emitted through 'imageCapture' EventEmitter
     * @param {?} trigger
     * @return {?}
     */
    set trigger(trigger) {
        if (this.triggerSubscription) {
            this.triggerSubscription.unsubscribe();
        }
        // Subscribe to events from this Observable to take snapshots
        this.triggerSubscription = trigger.subscribe(() => {
            this.takeSnapshot();
        });
    }
    /**
     * If the given Observable emits, the active webcam will be switched to the one indicated by the emitted value.
     * @param {?} switchCamera Indicates which webcam to switch to
     *   true: cycle forwards through available webcams
     *   false: cycle backwards through available webcams
     *   string: activate the webcam with the given id
     * @return {?}
     */
    set switchCamera(switchCamera) {
        if (this.switchCameraSubscription) {
            this.switchCameraSubscription.unsubscribe();
        }
        // Subscribe to events from this Observable to switch video device
        this.switchCameraSubscription = switchCamera.subscribe((value) => {
            if (typeof value === 'string') {
                // deviceId was specified
                this.switchToVideoInput(value);
            }
            else {
                // direction was specified
                this.rotateVideoInput(value !== false);
            }
        });
    }
    /**
     * Get MediaTrackConstraints to request streaming the given device
     * @private
     * @param {?} deviceId
     * @param {?} baseMediaTrackConstraints base constraints to merge deviceId-constraint into
     * @return {?}
     */
    static getMediaConstraintsForDevice(deviceId, baseMediaTrackConstraints) {
        /** @type {?} */
        const result = baseMediaTrackConstraints ? baseMediaTrackConstraints : this.DEFAULT_VIDEO_OPTIONS;
        if (deviceId) {
            result.deviceId = { exact: deviceId };
        }
        return result;
    }
    /**
     * Tries to harvest the deviceId from the given mediaStreamTrack object.
     * Browsers populate this object differently; this method tries some different approaches
     * to read the id.
     * @private
     * @param {?} mediaStreamTrack
     * @return {?} deviceId if found in the mediaStreamTrack
     */
    static getDeviceIdFromMediaStreamTrack(mediaStreamTrack) {
        if (mediaStreamTrack.getSettings && mediaStreamTrack.getSettings() && mediaStreamTrack.getSettings().deviceId) {
            return mediaStreamTrack.getSettings().deviceId;
        }
        else if (mediaStreamTrack.getConstraints && mediaStreamTrack.getConstraints() && mediaStreamTrack.getConstraints().deviceId) {
            /** @type {?} */
            const deviceIdObj = mediaStreamTrack.getConstraints().deviceId;
            return WebcamComponent.getValueFromConstrainDOMString(deviceIdObj);
        }
    }
    /**
     * Tries to harvest the facingMode from the given mediaStreamTrack object.
     * Browsers populate this object differently; this method tries some different approaches
     * to read the value.
     * @private
     * @param {?} mediaStreamTrack
     * @return {?} facingMode if found in the mediaStreamTrack
     */
    static getFacingModeFromMediaStreamTrack(mediaStreamTrack) {
        if (mediaStreamTrack) {
            if (mediaStreamTrack.getSettings && mediaStreamTrack.getSettings() && mediaStreamTrack.getSettings().facingMode) {
                return mediaStreamTrack.getSettings().facingMode;
            }
            else if (mediaStreamTrack.getConstraints && mediaStreamTrack.getConstraints() && mediaStreamTrack.getConstraints().facingMode) {
                /** @type {?} */
                const facingModeConstraint = mediaStreamTrack.getConstraints().facingMode;
                return WebcamComponent.getValueFromConstrainDOMString(facingModeConstraint);
            }
        }
    }
    /**
     * Determines whether the given mediaStreamTrack claims itself as user facing
     * @private
     * @param {?} mediaStreamTrack
     * @return {?}
     */
    static isUserFacing(mediaStreamTrack) {
        /** @type {?} */
        const facingMode = WebcamComponent.getFacingModeFromMediaStreamTrack(mediaStreamTrack);
        return facingMode ? 'user' === facingMode.toLowerCase() : false;
    }
    /**
     * Extracts the value from the given ConstrainDOMString
     * @private
     * @param {?} constrainDOMString
     * @return {?}
     */
    static getValueFromConstrainDOMString(constrainDOMString) {
        if (constrainDOMString) {
            if (constrainDOMString instanceof String) {
                return String(constrainDOMString);
            }
            else if (Array.isArray(constrainDOMString) && Array(constrainDOMString).length > 0) {
                return String(constrainDOMString[0]);
            }
            else if (typeof constrainDOMString === 'object') {
                if (constrainDOMString['exact']) {
                    return String(constrainDOMString['exact']);
                }
                else if (constrainDOMString['ideal']) {
                    return String(constrainDOMString['ideal']);
                }
            }
        }
        return null;
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        this.detectAvailableDevices()
            .then((devices) => {
            // start first device
            this.switchToVideoInput(devices.length > 0 ? devices[0].deviceId : null);
        })
            .catch((err) => {
            this.initError.next((/** @type {?} */ ({ message: err })));
            // fallback: still try to load webcam, even if device enumeration failed
            this.switchToVideoInput(null);
        });
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.stopMediaTracks();
        this.unsubscribeFromSubscriptions();
    }
    /**
     * Takes a snapshot of the current webcam's view and emits the image as an event
     * @return {?}
     */
    takeSnapshot() {
        // set canvas size to actual video size
        /** @type {?} */
        const _video = this.video.nativeElement;
        /** @type {?} */
        const dimensions = { width: this.width, height: this.height };
        if (_video.videoWidth) {
            dimensions.width = _video.videoWidth;
            dimensions.height = _video.videoHeight;
        }
        /** @type {?} */
        const _canvas = this.canvas.nativeElement;
        _canvas.width = dimensions.width;
        _canvas.height = dimensions.height;
        // paint snapshot image to canvas
        /** @type {?} */
        const context2d = _canvas.getContext('2d');
        context2d.drawImage(this.video.nativeElement, 0, 0);
        // read canvas content as image
        /** @type {?} */
        const mimeType = this.imageType ? this.imageType : WebcamComponent.DEFAULT_IMAGE_TYPE;
        /** @type {?} */
        const quality = this.imageQuality ? this.imageQuality : WebcamComponent.DEFAULT_IMAGE_QUALITY;
        /** @type {?} */
        const dataUrl = _canvas.toDataURL(mimeType, quality);
        // get the ImageData object from the canvas' context.
        /** @type {?} */
        let imageData = null;
        if (this.captureImageData) {
            imageData = context2d.getImageData(0, 0, _canvas.width, _canvas.height);
        }
        this.imageCapture.next(new WebcamImage(dataUrl, mimeType, imageData));
    }
    /**
     * Switches to the next/previous video device
     * @param {?} forward
     * @return {?}
     */
    rotateVideoInput(forward) {
        if (this.availableVideoInputs && this.availableVideoInputs.length > 1) {
            /** @type {?} */
            const increment = forward ? 1 : (this.availableVideoInputs.length - 1);
            /** @type {?} */
            const nextInputIndex = (this.activeVideoInputIndex + increment) % this.availableVideoInputs.length;
            this.switchToVideoInput(this.availableVideoInputs[nextInputIndex].deviceId);
        }
    }
    /**
     * Switches the camera-view to the specified video device
     * @param {?} deviceId
     * @return {?}
     */
    switchToVideoInput(deviceId) {
        this.videoInitialized = false;
        this.stopMediaTracks();
        this.initWebcam(deviceId, this.videoOptions);
    }
    /**
     * Event-handler for video resize event.
     * Triggers Angular change detection so that new video dimensions get applied
     * @return {?}
     */
    videoResize() {
        // here to trigger Angular change detection
    }
    /**
     * @return {?}
     */
    get videoWidth() {
        /** @type {?} */
        const videoRatio = this.getVideoAspectRatio();
        return Math.min(this.width, this.height * videoRatio);
    }
    /**
     * @return {?}
     */
    get videoHeight() {
        /** @type {?} */
        const videoRatio = this.getVideoAspectRatio();
        return Math.min(this.height, this.width / videoRatio);
    }
    /**
     * @return {?}
     */
    get videoStyleClasses() {
        /** @type {?} */
        let classes = '';
        if (this.isMirrorImage()) {
            classes += 'mirrored ';
        }
        return classes.trim();
    }
    /**
     * Returns the video aspect ratio of the active video stream
     * @private
     * @return {?}
     */
    getVideoAspectRatio() {
        // calculate ratio from video element dimensions if present
        /** @type {?} */
        const videoElement = this.video.nativeElement;
        if (videoElement.videoWidth && videoElement.videoWidth > 0 &&
            videoElement.videoHeight && videoElement.videoHeight > 0) {
            return videoElement.videoWidth / videoElement.videoHeight;
        }
        // nothing present - calculate ratio based on width/height params
        return this.width / this.height;
    }
    /**
     * Init webcam live view
     * @private
     * @param {?} deviceId
     * @param {?} userVideoTrackConstraints
     * @return {?}
     */
    initWebcam(deviceId, userVideoTrackConstraints) {
        /** @type {?} */
        const _video = this.video.nativeElement;
        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            // merge deviceId -> userVideoTrackConstraints
            /** @type {?} */
            const videoTrackConstraints = WebcamComponent.getMediaConstraintsForDevice(deviceId, userVideoTrackConstraints);
            navigator.mediaDevices.getUserMedia((/** @type {?} */ ({ video: videoTrackConstraints })))
                .then((stream) => {
                this.mediaStream = stream;
                _video.srcObject = stream;
                _video.play();
                this.activeVideoSettings = stream.getVideoTracks()[0].getSettings();
                /** @type {?} */
                const activeDeviceId = WebcamComponent.getDeviceIdFromMediaStreamTrack(stream.getVideoTracks()[0]);
                this.activeVideoInputIndex = activeDeviceId ? this.availableVideoInputs
                    .findIndex((mediaDeviceInfo) => mediaDeviceInfo.deviceId === activeDeviceId) : -1;
                this.videoInitialized = true;
                this.cameraSwitched.next(activeDeviceId);
            })
                .catch((err) => {
                this.initError.next((/** @type {?} */ ({ message: err.message, mediaStreamError: err })));
            });
        }
        else {
            this.initError.next((/** @type {?} */ ({ message: 'Cannot read UserMedia from MediaDevices.' })));
        }
    }
    /**
     * @private
     * @return {?}
     */
    getActiveVideoTrack() {
        return this.mediaStream ? this.mediaStream.getVideoTracks()[0] : null;
    }
    /**
     * @private
     * @return {?}
     */
    isMirrorImage() {
        if (!this.getActiveVideoTrack()) {
            return false;
        }
        // check for explicit mirror override parameter
        {
            /** @type {?} */
            let mirror = 'auto';
            if (this.mirrorImage) {
                if (typeof this.mirrorImage === 'string') {
                    mirror = String(this.mirrorImage).toLowerCase();
                }
                else {
                    // WebcamMirrorProperties
                    if (this.mirrorImage.x) {
                        mirror = this.mirrorImage.x.toLowerCase();
                    }
                }
            }
            switch (mirror) {
                case 'always':
                    return true;
                case 'never':
                    return false;
            }
        }
        // default: enable mirroring if webcam is user facing
        return WebcamComponent.isUserFacing(this.getActiveVideoTrack());
    }
    /**
     * Stops all active media tracks.
     * This prevents the webcam from being indicated as active,
     * even if it is no longer used by this component.
     * @private
     * @return {?}
     */
    stopMediaTracks() {
        if (this.mediaStream && this.mediaStream.getTracks) {
            // getTracks() returns all media tracks (video+audio)
            this.mediaStream.getTracks()
                .forEach((track) => track.stop());
        }
    }
    /**
     * Unsubscribe from all open subscriptions
     * @private
     * @return {?}
     */
    unsubscribeFromSubscriptions() {
        if (this.triggerSubscription) {
            this.triggerSubscription.unsubscribe();
        }
        if (this.switchCameraSubscription) {
            this.switchCameraSubscription.unsubscribe();
        }
    }
    /**
     * Reads available input devices
     * @private
     * @return {?}
     */
    detectAvailableDevices() {
        return new Promise((resolve, reject) => {
            WebcamUtil.getAvailableVideoInputs()
                .then((devices) => {
                this.availableVideoInputs = devices;
                resolve(devices);
            })
                .catch(err => {
                this.availableVideoInputs = [];
                reject(err);
            });
        });
    }
}
WebcamComponent.DEFAULT_VIDEO_OPTIONS = { facingMode: 'environment' };
WebcamComponent.DEFAULT_IMAGE_TYPE = 'image/jpeg';
WebcamComponent.DEFAULT_IMAGE_QUALITY = 0.92;
WebcamComponent.decorators = [
    { type: Component, args: [{
                selector: 'webcam',
                template: "<div class=\"webcam-wrapper\" (click)=\"imageClick.next();\">\r\n  <video #video [width]=\"videoWidth\" [height]=\"videoHeight\" [class]=\"videoStyleClasses\" autoplay muted playsinline (resize)=\"videoResize()\"></video>\r\n  <div class=\"camera-switch\" *ngIf=\"allowCameraSwitch && availableVideoInputs.length > 1 && videoInitialized\" (click)=\"rotateVideoInput(true)\"></div>\r\n  <canvas #canvas [width]=\"width\" [height]=\"height\"></canvas>\r\n</div>\r\n",
                styles: [".webcam-wrapper{display:inline-block;position:relative;line-height:0}.webcam-wrapper video.mirrored{-webkit-transform:scale(-1,1);transform:scale(-1,1)}.webcam-wrapper canvas{display:none}.webcam-wrapper .camera-switch{background-color:rgba(0,0,0,.1);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAE9UlEQVR42u2aT2hdRRTGf+cRQqghSqihdBFDkRISK2KDfzDWxHaRQHEhaINKqa1gKQhd6EZLN+IidCH+Q0oWIkVRC21BQxXRitVaSbKoJSGtYGoK2tQ/tU1jY5v0c5F54Xl7b/KSO/PyEt+3e5f75p7zzZwzZ74zUEIJJfyfYaEGllQGVAGZlENdBy6Z2cSiYFTSKkkfS/pH/nBF0kFJdUW9AiRVASeAukD8DgNrzOySrwEzng18KaDzALXuG8W3AiStAvqBisBRNg40mtlPxbYCOgvgPO4bncWW+JpVeDQXRQhIygDfA00F5r0XuNfMrgclQFI98DDQCNQA5ZFXqoCWBVp8XwHRHeEqcN7loy/NbHBesyqpQ1KfFj/6nC+ZvFaApFrgPaCZpYVvgCfNbDiRAElNwGFg+RIt/X8H2s2s9wYCJDUAR4HqJX7++RN40MwGpgmQVAH0AQ2BPz4AHHPl8nBOAqtyFWQjsA6oL4Ada81sPDv7uwImod8kvSJp9RyS8O2SXnb/DYVd2Y9VSroQ4ANXJO2WVJmixqh0kzMWwL4LkiqRtDnA4D1zmfE8j9g9AezcnAHaPcfXdbfdnPZ2Yps6+DwAvO/Z1naTdApY7Xng48BDZnY1MpMVQBuw3iXc5Tnb0wBwBPjUzP6eoezuArZ6svM0geJLkvZEYnl3nkntoqROSbckSW2Suj3ZOIangc7GPJuUtNGdFIfmMeavktoSSKiW9LMPw30Q8JqkekmjCbOZRhuclLQjgYSNxUBAj6RyZ9ATgUJpUtJTCSR8vpAEXHAyWK5BXYFIGHOlepSAloUk4NEYgyoknQhEwhFJ0e8h6VSaQeerCb5uZgdi9utxYBNwOUD93hIVXswM4INCi6K9wAszFC2DwLOBDjHbYp59karIUnRdzYy/3ClqVklaUhfwTICj7K25OqA7a4wWagVsm4Me/xzwg2cCqqONFzO7DPxSCAJi436GUBgHHguQD2oTlJ55oSzP9ybccsttSJw1szdjFOSnI/8dTCGZHwcORp4Nx7y3B1iZ8/sm4MW8/Euxg5wIsS/HaAp3zeP4/G7obRDXI4jiTIA22H7Xdc7X+S3A5lC7QBQ357aq3VAjCeSkwUfAJrfvz+R8A9ADLAtZB+TinpjC5JMA+//jwPZZnF8G7J+L8z4IWB/zbG+gIujVWfLBW/NStVMmqaG4POJRsIjix7h8IGnLQuoBbQki5sVAJHyYm7YkNaRRtXwQ8G1cHpX0iKRrgUjYno17Sf0LrQhJUkdCeHWkVITGJI0k1QeS3ikGSUzOyJUJJNznYneuOCnpTldcxa2kP3xJYqOeSDjqZG8ShJLnE8TTuMS6Iyu1BW7djZqkfo9N0QOuYJmYQddfB7RG+gLTNzqAY9FrL+5/nwEbvDdJJe3zzOrhNP3AWRqmk55t3ZcBuj3b2gb0Sbrbo/NNzk7fFzu7s/E5EiC+rrmeQU0Kx2skvRFoOx2ZzlmSdgbsw49JetvtBpk8nM64d/cGbNtJ0s7cGyJlwHeEv+t3nqnLSgPAUOSGyG3AHUxdzqoJbEcvcL+ZTeTeEapzJKxgaeOcc/7Mf06D7kFrguS0VDAMtGadv+E47DT9tcChJej8ISfpD+abgTe45uOkFi8mnQ+JBVQ+d4VXuOptjavcyot8pq86mfwk8LWZnaOEEkoooYQSSojDv8AhQNeGfe0jAAAAAElFTkSuQmCC);background-repeat:no-repeat;border-radius:5px;position:absolute;right:13px;top:10px;height:48px;width:48px;background-size:80%;cursor:pointer;background-position:center;transition:background-color .2s}.webcam-wrapper .camera-switch:hover{background-color:rgba(0,0,0,.18)}"]
            }] }
];
WebcamComponent.propDecorators = {
    width: [{ type: Input }],
    height: [{ type: Input }],
    videoOptions: [{ type: Input }],
    allowCameraSwitch: [{ type: Input }],
    mirrorImage: [{ type: Input }],
    captureImageData: [{ type: Input }],
    imageType: [{ type: Input }],
    imageQuality: [{ type: Input }],
    imageCapture: [{ type: Output }],
    initError: [{ type: Output }],
    imageClick: [{ type: Output }],
    cameraSwitched: [{ type: Output }],
    video: [{ type: ViewChild, args: ['video',] }],
    canvas: [{ type: ViewChild, args: ['canvas',] }],
    trigger: [{ type: Input }],
    switchCamera: [{ type: Input }]
};
if (false) {
    /**
     * @type {?}
     * @private
     */
    WebcamComponent.DEFAULT_VIDEO_OPTIONS;
    /**
     * @type {?}
     * @private
     */
    WebcamComponent.DEFAULT_IMAGE_TYPE;
    /**
     * @type {?}
     * @private
     */
    WebcamComponent.DEFAULT_IMAGE_QUALITY;
    /**
     * Defines the max width of the webcam area in px
     * @type {?}
     */
    WebcamComponent.prototype.width;
    /**
     * Defines the max height of the webcam area in px
     * @type {?}
     */
    WebcamComponent.prototype.height;
    /**
     * Defines base constraints to apply when requesting video track from UserMedia
     * @type {?}
     */
    WebcamComponent.prototype.videoOptions;
    /**
     * Flag to enable/disable camera switch. If enabled, a switch icon will be displayed if multiple cameras were found
     * @type {?}
     */
    WebcamComponent.prototype.allowCameraSwitch;
    /**
     * Parameter to control image mirroring (i.e. for user-facing camera). ["auto", "always", "never"]
     * @type {?}
     */
    WebcamComponent.prototype.mirrorImage;
    /**
     * Flag to control whether an ImageData object is stored into the WebcamImage object.
     * @type {?}
     */
    WebcamComponent.prototype.captureImageData;
    /**
     * The image type to use when capturing snapshots
     * @type {?}
     */
    WebcamComponent.prototype.imageType;
    /**
     * The image quality to use when capturing snapshots (number between 0 and 1)
     * @type {?}
     */
    WebcamComponent.prototype.imageQuality;
    /**
     * EventEmitter which fires when an image has been captured
     * @type {?}
     */
    WebcamComponent.prototype.imageCapture;
    /**
     * Emits a mediaError if webcam cannot be initialized (e.g. missing user permissions)
     * @type {?}
     */
    WebcamComponent.prototype.initError;
    /**
     * Emits when the webcam video was clicked
     * @type {?}
     */
    WebcamComponent.prototype.imageClick;
    /**
     * Emits the active deviceId after the active video device was switched
     * @type {?}
     */
    WebcamComponent.prototype.cameraSwitched;
    /**
     * available video devices
     * @type {?}
     */
    WebcamComponent.prototype.availableVideoInputs;
    /**
     * Indicates whether the video device is ready to be switched
     * @type {?}
     */
    WebcamComponent.prototype.videoInitialized;
    /**
     * If the Observable represented by this subscription emits, an image will be captured and emitted through
     * the 'imageCapture' EventEmitter
     * @type {?}
     * @private
     */
    WebcamComponent.prototype.triggerSubscription;
    /**
     * Index of active video in availableVideoInputs
     * @type {?}
     * @private
     */
    WebcamComponent.prototype.activeVideoInputIndex;
    /**
     * Subscription to switchCamera events
     * @type {?}
     * @private
     */
    WebcamComponent.prototype.switchCameraSubscription;
    /**
     * MediaStream object in use for streaming UserMedia data
     * @type {?}
     * @private
     */
    WebcamComponent.prototype.mediaStream;
    /**
     * @type {?}
     * @private
     */
    WebcamComponent.prototype.video;
    /**
     * Canvas for Video Snapshots
     * @type {?}
     * @private
     */
    WebcamComponent.prototype.canvas;
    /**
     * width and height of the active video stream
     * @type {?}
     * @private
     */
    WebcamComponent.prototype.activeVideoSettings;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2ViY2FtLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25neC13ZWJjYW0vIiwic291cmNlcyI6WyJzcmMvYXBwL21vZHVsZXMvd2ViY2FtL3dlYmNhbS93ZWJjYW0uY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQWdCLFNBQVMsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFhLE1BQU0sRUFBRSxTQUFTLEVBQUMsTUFBTSxlQUFlLENBQUM7QUFFMUcsT0FBTyxFQUFDLFdBQVcsRUFBQyxNQUFNLHdCQUF3QixDQUFDO0FBQ25ELE9BQU8sRUFBQyxVQUFVLEVBQWUsTUFBTSxNQUFNLENBQUM7QUFDOUMsT0FBTyxFQUFDLFVBQVUsRUFBQyxNQUFNLHFCQUFxQixDQUFDO0FBUS9DLE1BQU0sT0FBTyxlQUFlO0lBTDVCOzs7O1FBV2tCLFVBQUssR0FBVyxHQUFHLENBQUM7Ozs7UUFFcEIsV0FBTSxHQUFXLEdBQUcsQ0FBQzs7OztRQUVyQixpQkFBWSxHQUEwQixlQUFlLENBQUMscUJBQXFCLENBQUM7Ozs7UUFFNUUsc0JBQWlCLEdBQVksSUFBSSxDQUFDOzs7O1FBSWxDLHFCQUFnQixHQUFZLEtBQUssQ0FBQzs7OztRQUVsQyxjQUFTLEdBQVcsZUFBZSxDQUFDLGtCQUFrQixDQUFDOzs7O1FBRXZELGlCQUFZLEdBQVcsZUFBZSxDQUFDLHFCQUFxQixDQUFDOzs7O1FBRzVELGlCQUFZLEdBQThCLElBQUksWUFBWSxFQUFlLENBQUM7Ozs7UUFFMUUsY0FBUyxHQUFrQyxJQUFJLFlBQVksRUFBbUIsQ0FBQzs7OztRQUUvRSxlQUFVLEdBQXVCLElBQUksWUFBWSxFQUFRLENBQUM7Ozs7UUFFMUQsbUJBQWMsR0FBeUIsSUFBSSxZQUFZLEVBQVUsQ0FBQzs7OztRQUc1RSx5QkFBb0IsR0FBc0IsRUFBRSxDQUFDOzs7O1FBRzdDLHFCQUFnQixHQUFZLEtBQUssQ0FBQzs7OztRQU1qQywwQkFBcUIsR0FBVyxDQUFDLENB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bXBvcnQge0FmdGVyVmlld0luaXQsIENvbXBvbmVudCwgRXZlbnRFbWl0dGVyLCBJbnB1dCwgT25EZXN0cm95LCBPdXRwdXQsIFZpZXdDaGlsZH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7V2ViY2FtSW5pdEVycm9yfSBmcm9tICcuLi9kb21haW4vd2ViY2FtLWluaXQtZXJyb3InO1xyXG5pbXBvcnQge1dlYmNhbUltYWdlfSBmcm9tICcuLi9kb21haW4vd2ViY2FtLWltYWdlJztcclxuaW1wb3J0IHtPYnNlcnZhYmxlLCBTdWJzY3JpcHRpb259IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQge1dlYmNhbVV0aWx9IGZyb20gJy4uL3V0aWwvd2ViY2FtLnV0aWwnO1xyXG5pbXBvcnQge1dlYmNhbU1pcnJvclByb3BlcnRpZXN9IGZyb20gJy4uL2RvbWFpbi93ZWJjYW0tbWlycm9yLXByb3BlcnRpZXMnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICd3ZWJjYW0nLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi93ZWJjYW0uY29tcG9uZW50Lmh0bWwnLFxyXG4gIHN0eWxlVXJsczogWycuL3dlYmNhbS5jb21wb25lbnQuc2NzcyddXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBXZWJjYW1Db21wb25lbnQgaW1wbGVtZW50cyBBZnRlclZpZXdJbml0LCBPbkRlc3Ryb3kge1xyXG4gIHByaXZhdGUgc3RhdGljIERFRkFVTFRfVklERU9fT1BUSU9OUzogTWVkaWFUcmFja0NvbnN0cmFpbnRzID0ge2ZhY2luZ01vZGU6ICdlbnZpcm9ubWVudCd9O1xyXG4gIHByaXZhdGUgc3RhdGljIERFRkFVTFRfSU1BR0VfVFlQRTogc3RyaW5nID0gJ2ltYWdlL2pwZWcnO1xyXG4gIHByaXZhdGUgc3RhdGljIERFRkFVTFRfSU1BR0VfUVVBTElUWTogbnVtYmVyID0gMC45MjtcclxuXHJcbiAgLyoqIERlZmluZXMgdGhlIG1heCB3aWR0aCBvZiB0aGUgd2ViY2FtIGFyZWEgaW4gcHggKi9cclxuICBASW5wdXQoKSBwdWJsaWMgd2lkdGg6IG51bWJlciA9IDY0MDtcclxuICAvKiogRGVmaW5lcyB0aGUgbWF4IGhlaWdodCBvZiB0aGUgd2ViY2FtIGFyZWEgaW4gcHggKi9cclxuICBASW5wdXQoKSBwdWJsaWMgaGVpZ2h0OiBudW1iZXIgPSA0ODA7XHJcbiAgLyoqIERlZmluZXMgYmFzZSBjb25zdHJhaW50cyB0byBhcHBseSB3aGVuIHJlcXVlc3RpbmcgdmlkZW8gdHJhY2sgZnJvbSBVc2VyTWVkaWEgKi9cclxuICBASW5wdXQoKSBwdWJsaWMgdmlkZW9PcHRpb25zOiBNZWRpYVRyYWNrQ29uc3RyYWludHMgPSBXZWJjYW1Db21wb25lbnQuREVGQVVMVF9WSURFT19PUFRJT05TO1xyXG4gIC8qKiBGbGFnIHRvIGVuYWJsZS9kaXNhYmxlIGNhbWVyYSBzd2l0Y2guIElmIGVuYWJsZWQsIGEgc3dpdGNoIGljb24gd2lsbCBiZSBkaXNwbGF5ZWQgaWYgbXVsdGlwbGUgY2FtZXJhcyB3ZXJlIGZvdW5kICovXHJcbiAgQElucHV0KCkgcHVibGljIGFsbG93Q2FtZXJhU3dpdGNoOiBib29sZWFuID0gdHJ1ZTtcclxuICAvKiogUGFyYW1ldGVyIHRvIGNvbnRyb2wgaW1hZ2UgbWlycm9yaW5nIChpLmUuIGZvciB1c2VyLWZhY2luZyBjYW1lcmEpLiBbXCJhdXRvXCIsIFwiYWx3YXlzXCIsIFwibmV2ZXJcIl0gKi9cclxuICBASW5wdXQoKSBwdWJsaWMgbWlycm9ySW1hZ2U6IHN0cmluZyB8IFdlYmNhbU1pcnJvclByb3BlcnRpZXM7XHJcbiAgLyoqIEZsYWcgdG8gY29udHJvbCB3aGV0aGVyIGFuIEltYWdlRGF0YSBvYmplY3QgaXMgc3RvcmVkIGludG8gdGhlIFdlYmNhbUltYWdlIG9iamVjdC4gKi9cclxuICBASW5wdXQoKSBwdWJsaWMgY2FwdHVyZUltYWdlRGF0YTogYm9vbGVhbiA9IGZhbHNlO1xyXG4gIC8qKiBUaGUgaW1hZ2UgdHlwZSB0byB1c2Ugd2hlbiBjYXB0dXJpbmcgc25hcHNob3RzICovXHJcbiAgQElucHV0KCkgcHVibGljIGltYWdlVHlwZTogc3RyaW5nID0gV2ViY2FtQ29tcG9uZW50LkRFRkFVTFRfSU1BR0VfVFlQRTtcclxuICAvKiogVGhlIGltYWdlIHF1YWxpdHkgdG8gdXNlIHdoZW4gY2FwdHVyaW5nIHNuYXBzaG90cyAobnVtYmVyIGJldHdlZW4gMCBhbmQgMSkgKi9cclxuICBASW5wdXQoKSBwdWJsaWMgaW1hZ2VRdWFsaXR5OiBudW1iZXIgPSBXZWJjYW1Db21wb25lbnQuREVGQVVMVF9JTUFHRV9RVUFMSVRZO1xyXG5cclxuICAvKiogRXZlbnRFbWl0dGVyIHdoaWNoIGZpcmVzIHdoZW4gYW4gaW1hZ2UgaGFzIGJlZW4gY2FwdHVyZWQgKi9cclxuICBAT3V0cHV0KCkgcHVibGljIGltYWdlQ2FwdHVyZTogRXZlbnRFbWl0dGVyPFdlYmNhbUltYWdlPiA9IG5ldyBFdmVudEVtaXR0ZXI8V2ViY2FtSW1hZ2U+KCk7XHJcbiAgLyoqIEVtaXRzIGEgbWVkaWFFcnJvciBpZiB3ZWJjYW0gY2Fubm90IGJlIGluaXRpYWxpemVkIChlLmcuIG1pc3NpbmcgdXNlciBwZXJtaXNzaW9ucykgKi9cclxuICBAT3V0cHV0KCkgcHVibGljIGluaXRFcnJvcjogRXZlbnRFbWl0dGVyPFdlYmNhbUluaXRFcnJvcj4gPSBuZXcgRXZlbnRFbWl0dGVyPFdlYmNhbUluaXRFcnJvcj4oKTtcclxuICAvKiogRW1pdHMgd2hlbiB0aGUgd2ViY2FtIHZpZGVvIHdhcyBjbGlja2VkICovXHJcbiAgQE91dHB1dCgpIHB1YmxpYyBpbWFnZUNsaWNrOiBFdmVudEVtaXR0ZXI8dm9pZD4gPSBuZXcgRXZlbnRFbWl0dGVyPHZvaWQ+KCk7XHJcbiAgLyoqIEVtaXRzIHRoZSBhY3RpdmUgZGV2aWNlSWQgYWZ0ZXIgdGhlIGFjdGl2ZSB2aWRlbyBkZXZpY2Ugd2FzIHN3aXRjaGVkICovXHJcbiAgQE91dHB1dCgpIHB1YmxpYyBjYW1lcmFTd2l0Y2hlZDogRXZlbnRFbWl0dGVyPHN0cmluZz4gPSBuZXcgRXZlbnRFbWl0dGVyPHN0cmluZz4oKTtcclxuXHJcbiAgLyoqIGF2YWlsYWJsZSB2aWRlbyBkZXZpY2VzICovXHJcbiAgcHVibGljIGF2YWlsYWJsZVZpZGVvSW5wdXRzOiBNZWRpYURldmljZUluZm9bXSA9IFtdO1xyXG5cclxuICAvKiogSW5kaWNhdGVzIHdoZXRoZXIgdGhlIHZpZGVvIGRldmljZSBpcyByZWFkeSB0byBiZSBzd2l0Y2hlZCAqL1xyXG4gIHB1YmxpYyB2aWRlb0luaXRpYWxpemVkOiBib29sZWFuID0gZmFsc2U7XHJcblxyXG4gIC8qKiBJZiB0aGUgT2JzZXJ2YWJsZSByZXByZXNlbnRlZCBieSB0aGlzIHN1YnNjcmlwdGlvbiBlbWl0cywgYW4gaW1hZ2Ugd2lsbCBiZSBjYXB0dXJlZCBhbmQgZW1pdHRlZCB0aHJvdWdoXHJcbiAgICogdGhlICdpbWFnZUNhcHR1cmUnIEV2ZW50RW1pdHRlciAqL1xyXG4gIHByaXZhdGUgdHJpZ2dlclN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xyXG4gIC8qKiBJbmRleCBvZiBhY3RpdmUgdmlkZW8gaW4gYXZhaWxhYmxlVmlkZW9JbnB1dHMgKi9cclxuICBwcml2YXRlIGFjdGl2ZVZpZGVvSW5wdXRJbmRleDogbnVtYmVyID0gLTE7XHJcbiAgLyoqIFN1YnNjcmlwdGlvbiB0byBzd2l0Y2hDYW1lcmEgZXZlbnRzICovXHJcbiAgcHJpdmF0ZSBzd2l0Y2hDYW1lcmFTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcclxuICAvKiogTWVkaWFTdHJlYW0gb2JqZWN0IGluIHVzZSBmb3Igc3RyZWFtaW5nIFVzZXJNZWRpYSBkYXRhICovXHJcbiAgcHJpdmF0ZSBtZWRpYVN0cmVhbTogTWVkaWFTdHJlYW0gPSBudWxsO1xyXG4gIEBWaWV3Q2hpbGQoJ3ZpZGVvJykgcHJpdmF0ZSB2aWRlbzogYW55O1xyXG4gIC8qKiBDYW52YXMgZm9yIFZpZGVvIFNuYXBzaG90cyAqL1xyXG4gIEBWaWV3Q2hpbGQoJ2NhbnZhcycpIHByaXZhdGUgY2FudmFzOiBhbnk7XHJcblxyXG4gIC8qKiB3aWR0aCBhbmQgaGVpZ2h0IG9mIHRoZSBhY3RpdmUgdmlkZW8gc3RyZWFtICovXHJcbiAgcHJpdmF0ZSBhY3RpdmVWaWRlb1NldHRpbmdzOiBNZWRpYVRyYWNrU2V0dGluZ3MgPSBudWxsO1xyXG5cclxuICAvKipcclxuICAgKiBJZiB0aGUgZ2l2ZW4gT2JzZXJ2YWJsZSBlbWl0cywgYW4gaW1hZ2Ugd2lsbCBiZSBjYXB0dXJlZCBhbmQgZW1pdHRlZCB0aHJvdWdoICdpbWFnZUNhcHR1cmUnIEV2ZW50RW1pdHRlclxyXG4gICAqL1xyXG4gIEBJbnB1dCgpXHJcbiAgcHVibGljIHNldCB0cmlnZ2VyKHRyaWdnZXI6IE9ic2VydmFibGU8dm9pZD4pIHtcclxuICAgIGlmICh0aGlzLnRyaWdnZXJTdWJzY3JpcHRpb24pIHtcclxuICAgICAgdGhpcy50cmlnZ2VyU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gU3Vic2NyaWJlIHRvIGV2ZW50cyBmcm9tIHRoaXMgT2JzZXJ2YWJsZSB0byB0YWtlIHNuYXBzaG90c1xyXG4gICAgdGhpcy50cmlnZ2VyU3Vic2NyaXB0aW9uID0gdHJpZ2dlci5zdWJzY3JpYmUoKCkgPT4ge1xyXG4gICAgICB0aGlzLnRha2VTbmFwc2hvdCgpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBJZiB0aGUgZ2l2ZW4gT2JzZXJ2YWJsZSBlbWl0cywgdGhlIGFjdGl2ZSB3ZWJjYW0gd2lsbCBiZSBzd2l0Y2hlZCB0byB0aGUgb25lIGluZGljYXRlZCBieSB0aGUgZW1pdHRlZCB2YWx1ZS5cclxuICAgKiBAcGFyYW0gc3dpdGNoQ2FtZXJhIEluZGljYXRlcyB3aGljaCB3ZWJjYW0gdG8gc3dpdGNoIHRvXHJcbiAgICogICB0cnVlOiBjeWNsZSBmb3J3YXJkcyB0aHJvdWdoIGF2YWlsYWJsZSB3ZWJjYW1zXHJcbiAgICogICBmYWxzZTogY3ljbGUgYmFja3dhcmRzIHRocm91Z2ggYXZhaWxhYmxlIHdlYmNhbXNcclxuICAgKiAgIHN0cmluZzogYWN0aXZhdGUgdGhlIHdlYmNhbSB3aXRoIHRoZSBnaXZlbiBpZFxyXG4gICAqL1xyXG4gIEBJbnB1dCgpXHJcbiAgcHVibGljIHNldCBzd2l0Y2hDYW1lcmEoc3dpdGNoQ2FtZXJhOiBPYnNlcnZhYmxlPGJvb2xlYW4gfCBzdHJpbmc+KSB7XHJcbiAgICBpZiAodGhpcy5zd2l0Y2hDYW1lcmFTdWJzY3JpcHRpb24pIHtcclxuICAgICAgdGhpcy5zd2l0Y2hDYW1lcmFTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBTdWJzY3JpYmUgdG8gZXZlbnRzIGZyb20gdGhpcyBPYnNlcnZhYmxlIHRvIHN3aXRjaCB2aWRlbyBkZXZpY2VcclxuICAgIHRoaXMuc3dpdGNoQ2FtZXJhU3Vic2NyaXB0aW9uID0gc3dpdGNoQ2FtZXJhLnN1YnNjcmliZSgodmFsdWU6IGJvb2xlYW4gfCBzdHJpbmcpID0+IHtcclxuICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAvLyBkZXZpY2VJZCB3YXMgc3BlY2lmaWVkXHJcbiAgICAgICAgdGhpcy5zd2l0Y2hUb1ZpZGVvSW5wdXQodmFsdWUpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIGRpcmVjdGlvbiB3YXMgc3BlY2lmaWVkXHJcbiAgICAgICAgdGhpcy5yb3RhdGVWaWRlb0lucHV0KHZhbHVlICE9PSBmYWxzZSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0IE1lZGlhVHJhY2tDb25zdHJhaW50cyB0byByZXF1ZXN0IHN0cmVhbWluZyB0aGUgZ2l2ZW4gZGV2aWNlXHJcbiAgICogQHBhcmFtIGRldmljZUlkXHJcbiAgICogQHBhcmFtIGJhc2VNZWRpYVRyYWNrQ29uc3RyYWludHMgYmFzZSBjb25zdHJhaW50cyB0byBtZXJnZSBkZXZpY2VJZC1jb25zdHJhaW50IGludG9cclxuICAgKiBAcmV0dXJuc1xyXG4gICAqL1xyXG4gIHByaXZhdGUgc3RhdGljIGdldE1lZGlhQ29uc3RyYWludHNGb3JEZXZpY2UoZGV2aWNlSWQ6IHN0cmluZywgYmFzZU1lZGlhVHJhY2tDb25zdHJhaW50czogTWVkaWFUcmFja0NvbnN0cmFpbnRzKTogTWVkaWFUcmFja0NvbnN0cmFpbnRzIHtcclxuICAgIGNvbnN0IHJlc3VsdDogTWVkaWFUcmFja0NvbnN0cmFpbnRzID0gYmFzZU1lZGlhVHJhY2tDb25zdHJhaW50cyA/IGJhc2VNZWRpYVRyYWNrQ29uc3RyYWludHMgOiB0aGlzLkRFRkFVTFRfVklERU9fT1BUSU9OUztcclxuICAgIGlmIChkZXZpY2VJZCkge1xyXG4gICAgICByZXN1bHQuZGV2aWNlSWQgPSB7ZXhhY3Q6IGRldmljZUlkfTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVHJpZXMgdG8gaGFydmVzdCB0aGUgZGV2aWNlSWQgZnJvbSB0aGUgZ2l2ZW4gbWVkaWFTdHJlYW1UcmFjayBvYmplY3QuXHJcbiAgICogQnJvd3NlcnMgcG9wdWxhdGUgdGhpcyBvYmplY3QgZGlmZmVyZW50bHk7IHRoaXMgbWV0aG9kIHRyaWVzIHNvbWUgZGlmZmVyZW50IGFwcHJvYWNoZXNcclxuICAgKiB0byByZWFkIHRoZSBpZC5cclxuICAgKiBAcGFyYW0gbWVkaWFTdHJlYW1UcmFja1xyXG4gICAqIEByZXR1cm5zIGRldmljZUlkIGlmIGZvdW5kIGluIHRoZSBtZWRpYVN0cmVhbVRyYWNrXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzdGF0aWMgZ2V0RGV2aWNlSWRGcm9tTWVkaWFTdHJlYW1UcmFjayhtZWRpYVN0cmVhbVRyYWNrOiBNZWRpYVN0cmVhbVRyYWNrKTogc3RyaW5nIHtcclxuICAgIGlmIChtZWRpYVN0cmVhbVRyYWNrLmdldFNldHRpbmdzICYmIG1lZGlhU3RyZWFtVHJhY2suZ2V0U2V0dGluZ3MoKSAmJiBtZWRpYVN0cmVhbVRyYWNrLmdldFNldHRpbmdzKCkuZGV2aWNlSWQpIHtcclxuICAgICAgcmV0dXJuIG1lZGlhU3RyZWFtVHJhY2suZ2V0U2V0dGluZ3MoKS5kZXZpY2VJZDtcclxuICAgIH0gZWxzZSBpZiAobWVkaWFTdHJlYW1UcmFjay5nZXRDb25zdHJhaW50cyAmJiBtZWRpYVN0cmVhbVRyYWNrLmdldENvbnN0cmFpbnRzKCkgJiYgbWVkaWFTdHJlYW1UcmFjay5nZXRDb25zdHJhaW50cygpLmRldmljZUlkKSB7XHJcbiAgICAgIGNvbnN0IGRldmljZUlkT2JqOiBDb25zdHJhaW5ET01TdHJpbmcgPSBtZWRpYVN0cmVhbVRyYWNrLmdldENvbnN0cmFpbnRzKCkuZGV2aWNlSWQ7XHJcbiAgICAgIHJldHVybiBXZWJjYW1Db21wb25lbnQuZ2V0VmFsdWVGcm9tQ29uc3RyYWluRE9NU3RyaW5nKGRldmljZUlkT2JqKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFRyaWVzIHRvIGhhcnZlc3QgdGhlIGZhY2luZ01vZGUgZnJvbSB0aGUgZ2l2ZW4gbWVkaWFTdHJlYW1UcmFjayBvYmplY3QuXHJcbiAgICogQnJvd3NlcnMgcG9wdWxhdGUgdGhpcyBvYmplY3QgZGlmZmVyZW50bHk7IHRoaXMgbWV0aG9kIHRyaWVzIHNvbWUgZGlmZmVyZW50IGFwcHJvYWNoZXNcclxuICAgKiB0byByZWFkIHRoZSB2YWx1ZS5cclxuICAgKiBAcGFyYW0gbWVkaWFTdHJlYW1UcmFja1xyXG4gICAqIEByZXR1cm5zIGZhY2luZ01vZGUgaWYgZm91bmQgaW4gdGhlIG1lZGlhU3RyZWFtVHJhY2tcclxuICAgKi9cclxuICBwcml2YXRlIHN0YXRpYyBnZXRGYWNpbmdNb2RlRnJvbU1lZGlhU3RyZWFtVHJhY2sobWVkaWFTdHJlYW1UcmFjazogTWVkaWFTdHJlYW1UcmFjayk6IHN0cmluZyB7XHJcbiAgICBpZiAobWVkaWFTdHJlYW1UcmFjaykge1xyXG4gICAgICBpZiAobWVkaWFTdHJlYW1UcmFjay5nZXRTZXR0aW5ncyAmJiBtZWRpYVN0cmVhbVRyYWNrLmdldFNldHRpbmdzKCkgJiYgbWVkaWFTdHJlYW1UcmFjay5nZXRTZXR0aW5ncygpLmZhY2luZ01vZGUpIHtcclxuICAgICAgICByZXR1cm4gbWVkaWFTdHJlYW1UcmFjay5nZXRTZXR0aW5ncygpLmZhY2luZ01vZGU7XHJcbiAgICAgIH0gZWxzZSBpZiAobWVkaWFTdHJlYW1UcmFjay5nZXRDb25zdHJhaW50cyAmJiBtZWRpYVN0cmVhbVRyYWNrLmdldENvbnN0cmFpbnRzKCkgJiYgbWVkaWFTdHJlYW1UcmFjay5nZXRDb25zdHJhaW50cygpLmZhY2luZ01vZGUpIHtcclxuICAgICAgICBjb25zdCBmYWNpbmdNb2RlQ29uc3RyYWludDogQ29uc3RyYWluRE9NU3RyaW5nID0gbWVkaWFTdHJlYW1UcmFjay5nZXRDb25zdHJhaW50cygpLmZhY2luZ01vZGU7XHJcbiAgICAgICAgcmV0dXJuIFdlYmNhbUNvbXBvbmVudC5nZXRWYWx1ZUZyb21Db25zdHJhaW5ET01TdHJpbmcoZmFjaW5nTW9kZUNvbnN0cmFpbnQpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBEZXRlcm1pbmVzIHdoZXRoZXIgdGhlIGdpdmVuIG1lZGlhU3RyZWFtVHJhY2sgY2xhaW1zIGl0c2VsZiBhcyB1c2VyIGZhY2luZ1xyXG4gICAqIEBwYXJhbSBtZWRpYVN0cmVhbVRyYWNrXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzdGF0aWMgaXNVc2VyRmFjaW5nKG1lZGlhU3RyZWFtVHJhY2s6IE1lZGlhU3RyZWFtVHJhY2spOiBib29sZWFuIHtcclxuICAgIGNvbnN0IGZhY2luZ01vZGU6IHN0cmluZyA9IFdlYmNhbUNvbXBvbmVudC5nZXRGYWNpbmdNb2RlRnJvbU1lZGlhU3RyZWFtVHJhY2sobWVkaWFTdHJlYW1UcmFjayk7XHJcbiAgICByZXR1cm4gZmFjaW5nTW9kZSA/ICd1c2VyJyA9PT0gZmFjaW5nTW9kZS50b0xvd2VyQ2FzZSgpIDogZmFsc2U7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBFeHRyYWN0cyB0aGUgdmFsdWUgZnJvbSB0aGUgZ2l2ZW4gQ29uc3RyYWluRE9NU3RyaW5nXHJcbiAgICogQHBhcmFtIGNvbnN0cmFpbkRPTVN0cmluZ1xyXG4gICAqL1xyXG4gIHByaXZhdGUgc3RhdGljIGdldFZhbHVlRnJvbUNvbnN0cmFpbkRPTVN0cmluZyhjb25zdHJhaW5ET01TdHJpbmc6IENvbnN0cmFpbkRPTVN0cmluZyk6IHN0cmluZyB7XHJcbiAgICBpZiAoY29uc3RyYWluRE9NU3RyaW5nKSB7XHJcbiAgICAgIGlmIChjb25zdHJhaW5ET01TdHJpbmcgaW5zdGFuY2VvZiBTdHJpbmcpIHtcclxuICAgICAgICByZXR1cm4gU3RyaW5nKGNvbnN0cmFpbkRPTVN0cmluZyk7XHJcbiAgICAgIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShjb25zdHJhaW5ET01TdHJpbmcpICYmIEFycmF5KGNvbnN0cmFpbkRPTVN0cmluZykubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIHJldHVybiBTdHJpbmcoY29uc3RyYWluRE9NU3RyaW5nWzBdKTtcclxuICAgICAgfSBlbHNlIGlmICh0eXBlb2YgY29uc3RyYWluRE9NU3RyaW5nID09PSAnb2JqZWN0Jykge1xyXG4gICAgICAgIGlmIChjb25zdHJhaW5ET01TdHJpbmdbJ2V4YWN0J10pIHtcclxuICAgICAgICAgIHJldHVybiBTdHJpbmcoY29uc3RyYWluRE9NU3RyaW5nWydleGFjdCddKTtcclxuICAgICAgICB9IGVsc2UgaWYgKGNvbnN0cmFpbkRPTVN0cmluZ1snaWRlYWwnXSkge1xyXG4gICAgICAgICAgcmV0dXJuIFN0cmluZyhjb25zdHJhaW5ET01TdHJpbmdbJ2lkZWFsJ10pO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHtcclxuICAgIHRoaXMuZGV0ZWN0QXZhaWxhYmxlRGV2aWNlcygpXHJcbiAgICAgIC50aGVuKChkZXZpY2VzOiBNZWRpYURldmljZUluZm9bXSkgPT4ge1xyXG4gICAgICAgIC8vIHN0YXJ0IGZpcnN0IGRldmljZVxyXG4gICAgICAgIHRoaXMuc3dpdGNoVG9WaWRlb0lucHV0KGRldmljZXMubGVuZ3RoID4gMCA/IGRldmljZXNbMF0uZGV2aWNlSWQgOiBudWxsKTtcclxuICAgICAgfSlcclxuICAgICAgLmNhdGNoKChlcnI6IHN0cmluZykgPT4ge1xyXG4gICAgICAgIHRoaXMuaW5pdEVycm9yLm5leHQoPFdlYmNhbUluaXRFcnJvcj57bWVzc2FnZTogZXJyfSk7XHJcbiAgICAgICAgLy8gZmFsbGJhY2s6IHN0aWxsIHRyeSB0byBsb2FkIHdlYmNhbSwgZXZlbiBpZiBkZXZpY2UgZW51bWVyYXRpb24gZmFpbGVkXHJcbiAgICAgICAgdGhpcy5zd2l0Y2hUb1ZpZGVvSW5wdXQobnVsbCk7XHJcbiAgICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG5nT25EZXN0cm95KCk6IHZvaWQge1xyXG4gICAgdGhpcy5zdG9wTWVkaWFUcmFja3MoKTtcclxuICAgIHRoaXMudW5zdWJzY3JpYmVGcm9tU3Vic2NyaXB0aW9ucygpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVGFrZXMgYSBzbmFwc2hvdCBvZiB0aGUgY3VycmVudCB3ZWJjYW0ncyB2aWV3IGFuZCBlbWl0cyB0aGUgaW1hZ2UgYXMgYW4gZXZlbnRcclxuICAgKi9cclxuICBwdWJsaWMgdGFrZVNuYXBzaG90KCk6IHZvaWQge1xyXG4gICAgLy8gc2V0IGNhbnZhcyBzaXplIHRvIGFjdHVhbCB2aWRlbyBzaXplXHJcbiAgICBjb25zdCBfdmlkZW8gPSB0aGlzLnZpZGVvLm5hdGl2ZUVsZW1lbnQ7XHJcbiAgICBjb25zdCBkaW1lbnNpb25zID0ge3dpZHRoOiB0aGlzLndpZHRoLCBoZWlnaHQ6IHRoaXMuaGVpZ2h0fTtcclxuICAgIGlmIChfdmlkZW8udmlkZW9XaWR0aCkge1xyXG4gICAgICBkaW1lbnNpb25zLndpZHRoID0gX3ZpZGVvLnZpZGVvV2lkdGg7XHJcbiAgICAgIGRpbWVuc2lvbnMuaGVpZ2h0ID0gX3ZpZGVvLnZpZGVvSGVpZ2h0O1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IF9jYW52YXMgPSB0aGlzLmNhbnZhcy5uYXRpdmVFbGVtZW50O1xyXG4gICAgX2NhbnZhcy53aWR0aCA9IGRpbWVuc2lvbnMud2lkdGg7XHJcbiAgICBfY2FudmFzLmhlaWdodCA9IGRpbWVuc2lvbnMuaGVpZ2h0O1xyXG5cclxuICAgIC8vIHBhaW50IHNuYXBzaG90IGltYWdlIHRvIGNhbnZhc1xyXG4gICAgY29uc3QgY29udGV4dDJkID0gX2NhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xyXG4gICAgY29udGV4dDJkLmRyYXdJbWFnZSh0aGlzLnZpZGVvLm5hdGl2ZUVsZW1lbnQsIDAsIDApO1xyXG5cclxuICAgIC8vIHJlYWQgY2FudmFzIGNvbnRlbnQgYXMgaW1hZ2VcclxuICAgIGNvbnN0IG1pbWVUeXBlOiBzdHJpbmcgPSB0aGlzLmltYWdlVHlwZSA/IHRoaXMuaW1hZ2VUeXBlIDogV2ViY2FtQ29tcG9uZW50LkRFRkFVTFRfSU1BR0VfVFlQRTtcclxuICAgIGNvbnN0IHF1YWxpdHk6IG51bWJlciA9IHRoaXMuaW1hZ2VRdWFsaXR5ID8gdGhpcy5pbWFnZVF1YWxpdHkgOiBXZWJjYW1Db21wb25lbnQuREVGQVVMVF9JTUFHRV9RVUFMSVRZO1xyXG4gICAgY29uc3QgZGF0YVVybDogc3RyaW5nID0gX2NhbnZhcy50b0RhdGFVUkwobWltZVR5cGUsIHF1YWxpdHkpO1xyXG5cclxuICAgIC8vIGdldCB0aGUgSW1hZ2VEYXRhIG9iamVjdCBmcm9tIHRoZSBjYW52YXMnIGNvbnRleHQuXHJcbiAgICBsZXQgaW1hZ2VEYXRhOiBJbWFnZURhdGEgPSBudWxsO1xyXG5cclxuICAgIGlmICh0aGlzLmNhcHR1cmVJbWFnZURhdGEpIHtcclxuICAgICAgaW1hZ2VEYXRhID0gY29udGV4dDJkLmdldEltYWdlRGF0YSgwLCAwLCBfY2FudmFzLndpZHRoLCBfY2FudmFzLmhlaWdodCk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5pbWFnZUNhcHR1cmUubmV4dChuZXcgV2ViY2FtSW1hZ2UoZGF0YVVybCwgbWltZVR5cGUsIGltYWdlRGF0YSkpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU3dpdGNoZXMgdG8gdGhlIG5leHQvcHJldmlvdXMgdmlkZW8gZGV2aWNlXHJcbiAgICogQHBhcmFtIGZvcndhcmRcclxuICAgKi9cclxuICBwdWJsaWMgcm90YXRlVmlkZW9JbnB1dChmb3J3YXJkOiBib29sZWFuKSB7XHJcbiAgICBpZiAodGhpcy5hdmFpbGFibGVWaWRlb0lucHV0cyAmJiB0aGlzLmF2YWlsYWJsZVZpZGVvSW5wdXRzLmxlbmd0aCA+IDEpIHtcclxuICAgICAgY29uc3QgaW5jcmVtZW50OiBudW1iZXIgPSBmb3J3YXJkID8gMSA6ICh0aGlzLmF2YWlsYWJsZVZpZGVvSW5wdXRzLmxlbmd0aCAtIDEpO1xyXG4gICAgICBjb25zdCBuZXh0SW5wdXRJbmRleCA9ICh0aGlzLmFjdGl2ZVZpZGVvSW5wdXRJbmRleCArIGluY3JlbWVudCkgJSB0aGlzLmF2YWlsYWJsZVZpZGVvSW5wdXRzLmxlbmd0aDtcclxuICAgICAgdGhpcy5zd2l0Y2hUb1ZpZGVvSW5wdXQodGhpcy5hdmFpbGFibGVWaWRlb0lucHV0c1tuZXh0SW5wdXRJbmRleF0uZGV2aWNlSWQpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU3dpdGNoZXMgdGhlIGNhbWVyYS12aWV3IHRvIHRoZSBzcGVjaWZpZWQgdmlkZW8gZGV2aWNlXHJcbiAgICovXHJcbiAgcHVibGljIHN3aXRjaFRvVmlkZW9JbnB1dChkZXZpY2VJZDogc3RyaW5nKTogdm9pZCB7XHJcbiAgICB0aGlzLnZpZGVvSW5pdGlhbGl6ZWQgPSBmYWxzZTtcclxuICAgIHRoaXMuc3RvcE1lZGlhVHJhY2tzKCk7XHJcbiAgICB0aGlzLmluaXRXZWJjYW0oZGV2aWNlSWQsIHRoaXMudmlkZW9PcHRpb25zKTtcclxuICB9XHJcblxyXG5cclxuICAvKipcclxuICAgKiBFdmVudC1oYW5kbGVyIGZvciB2aWRlbyByZXNpemUgZXZlbnQuXHJcbiAgICogVHJpZ2dlcnMgQW5ndWxhciBjaGFuZ2UgZGV0ZWN0aW9uIHNvIHRoYXQgbmV3IHZpZGVvIGRpbWVuc2lvbnMgZ2V0IGFwcGxpZWRcclxuICAgKi9cclxuICBwdWJsaWMgdmlkZW9SZXNpemUoKTogdm9pZCB7XHJcbiAgICAvLyBoZXJlIHRvIHRyaWdnZXIgQW5ndWxhciBjaGFuZ2UgZGV0ZWN0aW9uXHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0IHZpZGVvV2lkdGgoKSB7XHJcbiAgICBjb25zdCB2aWRlb1JhdGlvID0gdGhpcy5nZXRWaWRlb0FzcGVjdFJhdGlvKCk7XHJcbiAgICByZXR1cm4gTWF0aC5taW4odGhpcy53aWR0aCwgdGhpcy5oZWlnaHQgKiB2aWRlb1JhdGlvKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXQgdmlkZW9IZWlnaHQoKSB7XHJcbiAgICBjb25zdCB2aWRlb1JhdGlvID0gdGhpcy5nZXRWaWRlb0FzcGVjdFJhdGlvKCk7XHJcbiAgICByZXR1cm4gTWF0aC5taW4odGhpcy5oZWlnaHQsIHRoaXMud2lkdGggLyB2aWRlb1JhdGlvKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXQgdmlkZW9TdHlsZUNsYXNzZXMoKSB7XHJcbiAgICBsZXQgY2xhc3Nlczogc3RyaW5nID0gJyc7XHJcblxyXG4gICAgaWYgKHRoaXMuaXNNaXJyb3JJbWFnZSgpKSB7XHJcbiAgICAgIGNsYXNzZXMgKz0gJ21pcnJvcmVkICc7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGNsYXNzZXMudHJpbSgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmV0dXJucyB0aGUgdmlkZW8gYXNwZWN0IHJhdGlvIG9mIHRoZSBhY3RpdmUgdmlkZW8gc3RyZWFtXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXRWaWRlb0FzcGVjdFJhdGlvKCk6IG51bWJlciB7XHJcbiAgICAvLyBjYWxjdWxhdGUgcmF0aW8gZnJvbSB2aWRlbyBlbGVtZW50IGRpbWVuc2lvbnMgaWYgcHJlc2VudFxyXG4gICAgY29uc3QgdmlkZW9FbGVtZW50ID0gdGhpcy52aWRlby5uYXRpdmVFbGVtZW50O1xyXG4gICAgaWYgKHZpZGVvRWxlbWVudC52aWRlb1dpZHRoICYmIHZpZGVvRWxlbWVudC52aWRlb1dpZHRoID4gMCAmJlxyXG4gICAgICB2aWRlb0VsZW1lbnQudmlkZW9IZWlnaHQgJiYgdmlkZW9FbGVtZW50LnZpZGVvSGVpZ2h0ID4gMCkge1xyXG5cclxuICAgICAgcmV0dXJuIHZpZGVvRWxlbWVudC52aWRlb1dpZHRoIC8gdmlkZW9FbGVtZW50LnZpZGVvSGVpZ2h0O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIG5vdGhpbmcgcHJlc2VudCAtIGNhbGN1bGF0ZSByYXRpbyBiYXNlZCBvbiB3aWR0aC9oZWlnaHQgcGFyYW1zXHJcbiAgICByZXR1cm4gdGhpcy53aWR0aCAvIHRoaXMuaGVpZ2h0O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogSW5pdCB3ZWJjYW0gbGl2ZSB2aWV3XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBpbml0V2ViY2FtKGRldmljZUlkOiBzdHJpbmcsIHVzZXJWaWRlb1RyYWNrQ29uc3RyYWludHM6IE1lZGlhVHJhY2tDb25zdHJhaW50cykge1xyXG4gICAgY29uc3QgX3ZpZGVvID0gdGhpcy52aWRlby5uYXRpdmVFbGVtZW50O1xyXG4gICAgaWYgKG5hdmlnYXRvci5tZWRpYURldmljZXMgJiYgbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5nZXRVc2VyTWVkaWEpIHtcclxuXHJcbiAgICAgIC8vIG1lcmdlIGRldmljZUlkIC0+IHVzZXJWaWRlb1RyYWNrQ29uc3RyYWludHNcclxuICAgICAgY29uc3QgdmlkZW9UcmFja0NvbnN0cmFpbnRzID0gV2ViY2FtQ29tcG9uZW50LmdldE1lZGlhQ29uc3RyYWludHNGb3JEZXZpY2UoZGV2aWNlSWQsIHVzZXJWaWRlb1RyYWNrQ29uc3RyYWludHMpO1xyXG5cclxuICAgICAgbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5nZXRVc2VyTWVkaWEoPE1lZGlhU3RyZWFtQ29uc3RyYWludHM+e3ZpZGVvOiB2aWRlb1RyYWNrQ29uc3RyYWludHN9KVxyXG4gICAgICAgIC50aGVuKChzdHJlYW06IE1lZGlhU3RyZWFtKSA9PiB7XHJcbiAgICAgICAgICB0aGlzLm1lZGlhU3RyZWFtID0gc3RyZWFtO1xyXG4gICAgICAgICAgX3ZpZGVvLnNyY09iamVjdCA9IHN0cmVhbTtcclxuICAgICAgICAgIF92aWRlby5wbGF5KCk7XHJcblxyXG4gICAgICAgICAgdGhpcy5hY3RpdmVWaWRlb1NldHRpbmdzID0gc3RyZWFtLmdldFZpZGVvVHJhY2tzKClbMF0uZ2V0U2V0dGluZ3MoKTtcclxuICAgICAgICAgIGNvbnN0IGFjdGl2ZURldmljZUlkOiBzdHJpbmcgPSBXZWJjYW1Db21wb25lbnQuZ2V0RGV2aWNlSWRGcm9tTWVkaWFTdHJlYW1UcmFjayhzdHJlYW0uZ2V0VmlkZW9UcmFja3MoKVswXSk7XHJcbiAgICAgICAgICB0aGlzLmFjdGl2ZVZpZGVvSW5wdXRJbmRleCA9IGFjdGl2ZURldmljZUlkID8gdGhpcy5hdmFpbGFibGVWaWRlb0lucHV0c1xyXG4gICAgICAgICAgICAuZmluZEluZGV4KChtZWRpYURldmljZUluZm86IE1lZGlhRGV2aWNlSW5mbykgPT4gbWVkaWFEZXZpY2VJbmZvLmRldmljZUlkID09PSBhY3RpdmVEZXZpY2VJZCkgOiAtMTtcclxuICAgICAgICAgIHRoaXMudmlkZW9Jbml0aWFsaXplZCA9IHRydWU7XHJcblxyXG4gICAgICAgICAgdGhpcy5jYW1lcmFTd2l0Y2hlZC5uZXh0KGFjdGl2ZURldmljZUlkKTtcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5jYXRjaCgoZXJyOiBNZWRpYVN0cmVhbUVycm9yKSA9PiB7XHJcbiAgICAgICAgICB0aGlzLmluaXRFcnJvci5uZXh0KDxXZWJjYW1Jbml0RXJyb3I+e21lc3NhZ2U6IGVyci5tZXNzYWdlLCBtZWRpYVN0cmVhbUVycm9yOiBlcnJ9KTtcclxuICAgICAgICB9KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuaW5pdEVycm9yLm5leHQoPFdlYmNhbUluaXRFcnJvcj57bWVzc2FnZTogJ0Nhbm5vdCByZWFkIFVzZXJNZWRpYSBmcm9tIE1lZGlhRGV2aWNlcy4nfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdldEFjdGl2ZVZpZGVvVHJhY2soKTogTWVkaWFTdHJlYW1UcmFjayB7XHJcbiAgICByZXR1cm4gdGhpcy5tZWRpYVN0cmVhbSA/IHRoaXMubWVkaWFTdHJlYW0uZ2V0VmlkZW9UcmFja3MoKVswXSA6IG51bGw7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGlzTWlycm9ySW1hZ2UoKTogYm9vbGVhbiB7XHJcbiAgICBpZiAoIXRoaXMuZ2V0QWN0aXZlVmlkZW9UcmFjaygpKSB7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBjaGVjayBmb3IgZXhwbGljaXQgbWlycm9yIG92ZXJyaWRlIHBhcmFtZXRlclxyXG4gICAge1xyXG4gICAgICBsZXQgbWlycm9yOiBzdHJpbmcgPSAnYXV0byc7XHJcbiAgICAgIGlmICh0aGlzLm1pcnJvckltYWdlKSB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiB0aGlzLm1pcnJvckltYWdlID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgbWlycm9yID0gU3RyaW5nKHRoaXMubWlycm9ySW1hZ2UpLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIC8vIFdlYmNhbU1pcnJvclByb3BlcnRpZXNcclxuICAgICAgICAgIGlmICh0aGlzLm1pcnJvckltYWdlLngpIHtcclxuICAgICAgICAgICAgbWlycm9yID0gdGhpcy5taXJyb3JJbWFnZS54LnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICBzd2l0Y2ggKG1pcnJvcikge1xyXG4gICAgICAgIGNhc2UgJ2Fsd2F5cyc6XHJcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICBjYXNlICduZXZlcic6XHJcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBkZWZhdWx0OiBlbmFibGUgbWlycm9yaW5nIGlmIHdlYmNhbSBpcyB1c2VyIGZhY2luZ1xyXG4gICAgcmV0dXJuIFdlYmNhbUNvbXBvbmVudC5pc1VzZXJGYWNpbmcodGhpcy5nZXRBY3RpdmVWaWRlb1RyYWNrKCkpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU3RvcHMgYWxsIGFjdGl2ZSBtZWRpYSB0cmFja3MuXHJcbiAgICogVGhpcyBwcmV2ZW50cyB0aGUgd2ViY2FtIGZyb20gYmVpbmcgaW5kaWNhdGVkIGFzIGFjdGl2ZSxcclxuICAgKiBldmVuIGlmIGl0IGlzIG5vIGxvbmdlciB1c2VkIGJ5IHRoaXMgY29tcG9uZW50LlxyXG4gICAqL1xyXG4gIHByaXZhdGUgc3RvcE1lZGlhVHJhY2tzKCkge1xyXG4gICAgaWYgKHRoaXMubWVkaWFTdHJlYW0gJiYgdGhpcy5tZWRpYVN0cmVhbS5nZXRUcmFja3MpIHtcclxuICAgICAgLy8gZ2V0VHJhY2tzKCkgcmV0dXJucyBhbGwgbWVkaWEgdHJhY2tzICh2aWRlbythdWRpbylcclxuICAgICAgdGhpcy5tZWRpYVN0cmVhbS5nZXRUcmFja3MoKVxyXG4gICAgICAgIC5mb3JFYWNoKCh0cmFjazogTWVkaWFTdHJlYW1UcmFjaykgPT4gdHJhY2suc3RvcCgpKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFVuc3Vic2NyaWJlIGZyb20gYWxsIG9wZW4gc3Vic2NyaXB0aW9uc1xyXG4gICAqL1xyXG4gIHByaXZhdGUgdW5zdWJzY3JpYmVGcm9tU3Vic2NyaXB0aW9ucygpIHtcclxuICAgIGlmICh0aGlzLnRyaWdnZXJTdWJzY3JpcHRpb24pIHtcclxuICAgICAgdGhpcy50cmlnZ2VyU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy5zd2l0Y2hDYW1lcmFTdWJzY3JpcHRpb24pIHtcclxuICAgICAgdGhpcy5zd2l0Y2hDYW1lcmFTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlYWRzIGF2YWlsYWJsZSBpbnB1dCBkZXZpY2VzXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBkZXRlY3RBdmFpbGFibGVEZXZpY2VzKCk6IFByb21pc2U8TWVkaWFEZXZpY2VJbmZvW10+IHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgIFdlYmNhbVV0aWwuZ2V0QXZhaWxhYmxlVmlkZW9JbnB1dHMoKVxyXG4gICAgICAgIC50aGVuKChkZXZpY2VzOiBNZWRpYURldmljZUluZm9bXSkgPT4ge1xyXG4gICAgICAgICAgdGhpcy5hdmFpbGFibGVWaWRlb0lucHV0cyA9IGRldmljZXM7XHJcbiAgICAgICAgICByZXNvbHZlKGRldmljZXMpO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmNhdGNoKGVyciA9PiB7XHJcbiAgICAgICAgICB0aGlzLmF2YWlsYWJsZVZpZGVvSW5wdXRzID0gW107XHJcbiAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbn1cclxuIl19